<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Kisso ‚Äì –ø—ñ—Ü–∞ –≤ –ö–æ–ª–æ–º–∏—ó | –¥–æ—Å—Ç–∞–≤–∫–∞ +380660209675</title>
  <meta name="description" content="–ù–∞–π—Å–º–∞—á–Ω—ñ—à–∞ –ø—ñ—Ü–∞ –≤ –ö–æ–ª–æ–º–∏—ó! –î–æ—Å—Ç–∞–≤–∫–∞ —ó–∂—ñ, —ñ—Ç–∞–ª—ñ–π—Å—å–∫–∞ –∫—É—Ö–Ω—è, –¥–µ—Å–µ—Ä—Ç–∏. –ó–∞–º–æ–≤–ª—è–π—Ç–µ –æ–Ω–ª–∞–π–Ω –∞–±–æ –∑–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º +380660209675. –í—É–ª. –Ü–≤–∞–Ω–∞ –ú–∏–∫–æ–ª–∞–π—á—É–∫–∞.">
  <meta name="keywords" content="–ø—ñ—Ü–∞ –ö–æ–ª–æ–º–∏—è, –¥–æ—Å—Ç–∞–≤–∫–∞ —ó–∂—ñ, —ñ—Ç–∞–ª—ñ–π—Å—å–∫–∞ –∫—É—Ö–Ω—è, Kisso, –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–æ–ª–∏–∫–∞, —Ä–µ—Å—Ç–æ—Ä–∞–Ω –ö–æ–ª–æ–º–∏—è, –ø—ñ—Ü–µ—Ä—ñ—è">
  <meta name="author" content="Kisso Restaurant">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://kisso.com.ua/" id="canonical-link">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="restaurant">
  <meta property="og:url" content="https://kisso.com.ua/">
  <meta property="og:title" content="Kisso ‚Äì –Ω–∞–π—Å–º–∞—á–Ω—ñ—à–∞ –ø—ñ—Ü–∞ –≤ –ö–æ–ª–æ–º–∏—ó">
  <meta property="og:description" content="–î–æ—Å—Ç–∞–≤–∫–∞ –ø—ñ—Ü–∏ —Ç–∞ —ñ—Ç–∞–ª—ñ–π—Å—å–∫–æ—ó –∫—É—Ö–Ω—ñ –≤ –ö–æ–ª–æ–º–∏—ó. –ó–∞–º–æ–≤–ª—è–π—Ç–µ –æ–Ω–ª–∞–π–Ω! üçï">
  <meta property="og:image" content="https://kisso.com.ua/images/og-image.jpg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:locale" content="uk_UA">
  <meta property="og:site_name" content="Kisso">
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="https://kisso.com.ua/">
  <meta name="twitter:title" content="Kisso ‚Äì –Ω–∞–π—Å–º–∞—á–Ω—ñ—à–∞ –ø—ñ—Ü–∞ –≤ –ö–æ–ª–æ–º–∏—ó">
  <meta name="twitter:description" content="–î–æ—Å—Ç–∞–≤–∫–∞ –ø—ñ—Ü–∏ —Ç–∞ —ñ—Ç–∞–ª—ñ–π—Å—å–∫–æ—ó –∫—É—Ö–Ω—ñ –≤ –ö–æ–ª–æ–º–∏—ó. –ó–∞–º–æ–≤–ª—è–π—Ç–µ –æ–Ω–ª–∞–π–Ω! üçï">
  <meta name="twitter:image" content="https://kisso.com.ua/images/og-image.jpg">
  
  <!-- Geo tags -->
  <meta name="geo.region" content="UA-IF">
  <meta name="geo.placename" content="Kolomyia">
  <meta name="geo.position" content="48.5312;25.0408">
  <meta name="ICBM" content="48.5312, 25.0408">
  
  <!-- PWA -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#e54b22">
  <meta name="mobile-web-app-capable" content="yes">
  <!-- Simple inline favicon (emoji SVG) to avoid 404 if no favicon file present -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Ctext x='0' y='14' font-size='14'%3E%F0%9F%8E%95%3C/text%3E%3C/svg%3E">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Kisso">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">
  
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçï</text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <!-- Fallback font-family to avoid invisible text if Google Fonts fail -->
  <style>body{font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;}</style>
  <link rel="stylesheet" href="/frontend/admin.frontend/libs/all.min.css">
  
  <!-- JSON-LD Structured Data -->
  <script type="application/ld+json" id="seo-ld-json">
  {
    "@context": "https://schema.org",
    "@type": "Restaurant",
    "name": "Kisso",
    "image": "https://kisso.com.ua/images/restaurant.jpg",
    "@id": "https://kisso.com.ua",
    "url": "https://kisso.com.ua",
    "telephone": "+380660209675",
    "priceRange": "‚Ç¥‚Ç¥",
    "menu": "https://kisso.com.ua/#menu",
    "servesCuisine": ["Italian", "Pizza", "Ukrainian"],
    "acceptsReservations": "True",
    "address": {
      "@type": "PostalAddress",
      "streetAddress": "–≤—É–ª. –Ü–≤–∞–Ω–∞ –ú–∏–∫–æ–ª–∞–π—á—É–∫–∞",
      "addressLocality": "–ö–æ–ª–æ–º–∏—è",
      "addressRegion": "–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å",
      "postalCode": "78200",
      "addressCountry": "UA"
    },
    "geo": {
      "@type": "GeoCoordinates",
      "latitude": 48.5312,
      "longitude": 25.0408
    },
    "openingHoursSpecification": [
      {
        "@type": "OpeningHoursSpecification",
        "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"],
        "opens": "10:00",
        "closes": "22:00"
      }
    ],
    "sameAs": [
      "https://instagram.com/kisso_kolomiya",
      "https://t.me/kisso_bot"
    ],
    "potentialAction": {
      "@type": "OrderAction",
      "target": {
        "@type": "EntryPoint",
        "urlTemplate": "https://kisso.com.ua/#menu",
        "actionPlatform": ["http://schema.org/DesktopWebPlatform", "http://schema.org/MobileWebPlatform"]
      },
      "deliveryMethod": ["http://purl.org/goodrelations/v1#DeliveryModeOwnFleet"]
    }
  }
  </script>

  <style>
    .sr-only { position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0; }
    :root {
      --tomato: #e54b22;
      --cheese: #f9c74f;
      --olive: #6a994e;
      --brown: #3d2b1f;
      --cream: #fff8f0;
      --radius: 18px;
      --font: 'Inter', sans-serif;
      --transition: .3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; font-family: var(--font); }
    html { scroll-behavior: smooth; }
    body { background: var(--cream); color: var(--brown); overflow-x: hidden; }

    a { color: inherit; text-decoration: none; }
    img { max-width: 100%; display: block; height: auto; }
    picture { display: block; }
    /* –î–æ–¥–∞—î–º–æ –ø–ª–∞–≤–Ω–∏–π –ø–µ—Ä–µ—Ö—ñ–¥ –¥–ª—è –∑–æ–±—Ä–∞–∂–µ–Ω—å */
    img, picture { transition: filter 0.3s; }

    /* ---------- header ---------- */
    header { 
      position: sticky; 
      top: 0; 
      z-index: 1000; 
      display: flex; 
      align-items: center; 
      justify-content: space-between; 
      padding: .75rem 1rem; 
      background: rgba(255,255,255,.85); 
      backdrop-filter: blur(8px); 
      transform: translateY(0);
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), background-color 0.4s;
    }
    header.hidden {
      transform: translateY(-100%);
    }
    header.scrolled {
      background: rgba(255,255,255,.95);
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }
    .logo { 
      display:flex;
      align-items:center;
      gap:0.6rem;
      position:relative;
      padding-left:0.5rem;
    }
    .logo img.site-logo {
      height:30px;
      display:block;
    }
    .logo img.app-icon {
      display: none;
      height:32px;
      width:32px;
      border-radius:8px;
      object-fit:cover;
    }
    .brand-text {
      font-weight:700;
      font-size:1.1rem;
      letter-spacing:0.02em;
    }
    .logo::before {
      content: '';
      position: absolute;
      left: -4px;
      top: 50%;
      transform: translateY(-50%);
      width: 4px;
      height: 70%;
      background: var(--tomato);
      border-radius: 2px;
      animation: logoPulse 2s infinite;
    }
    .burger { width: 30px; height: 24px; display: flex; flex-direction: column; justify-content: space-between; cursor: pointer; transition: var(--transition); }
    .burger:hover { transform: scale(1.1); }
    .burger span { width: 100%; height: 3px; background: var(--tomato); border-radius: 3px; transition: var(--transition); }
    .burger.open span:nth-child(1) { transform: rotate(45deg) translate(5px,5px); }
    .burger.open span:nth-child(2) { opacity: 0; }
    .burger.open span:nth-child(3) { transform: rotate(-45deg) translate(7px,-6px); }
    nav { 
      position: absolute; 
      top: 100%; 
      left: 0; 
      right: 0; 
      background: #fff; 
      max-height: 0; 
      overflow: hidden; 
      transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s 0.1s; 
      opacity: 0; 
      display: flex; 
      flex-direction: column; 
      padding: 0 1rem;
      border-radius: 0 0 var(--radius) var(--radius);
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    nav.open { max-height: 220px; opacity: 1; padding: .5rem 1rem; }
    nav a { 
      padding: .75rem 0; 
      font-weight: 600; 
      position: relative;
      transition: var(--transition);
      transform: translateX(-10px);
      opacity: 0;
    }
    nav.open a {
      transform: translateX(0);
      opacity: 1;
    }
    nav a:nth-child(1) { transition-delay: 0.1s; }
    nav a:nth-child(2) { transition-delay: 0.2s; }
    nav a:nth-child(3) { transition-delay: 0.3s; }
    nav a::after {
      content: '';
      position: absolute;
      left: 0;
      bottom: 0.5rem;
      width: 0;
      height: 2px;
      background: var(--tomato);
      transition: width 0.3s;
    }
    nav a:hover::after {
      width: 30px;
    }

    /* ---------- hero ---------- */
    .hero { 
      min-height: 62vh; 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      justify-content: center; 
      text-align: center; 
      padding: 3rem 1rem; 
      background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 600'%3E%3Crect fill='%23fff5ee' width='1200' height='600'/%3E%3Cpath fill='%23f9c74f' opacity='.25' d='M0 320L60 300L120 340L180 300L240 320L300 280L360 320L420 280L480 320L540 280L600 320L660 280L720 320L780 280L840 320L900 280L960 320L1020 280L1080 320L1140 280L1200 320V600H0V320Z'/%3E%3C/svg%3E") center/cover no-repeat;
      position: relative;
      overflow: hidden;
    }
    .hero::before {
      content: '';
      position: absolute;
      top: -40%;
      left: -30%;
      width: 160%;
      height: 160%;
      background: radial-gradient(circle, rgba(249,199,79,0.12) 0%, rgba(255,255,255,0) 70%);
      animation: rotate 40s linear infinite;
    }
    .hero h1 { 
      font-size: clamp(2.25rem,6vw,4rem); 
      margin-bottom: .25rem; 
      color: var(--tomato);
      font-weight: 800;
      letter-spacing: -0.5px;
      opacity: 0;
      transform: translateY(30px);
      text-shadow: 0 2px 0 rgba(255,255,255,0.6);
      animation: fadeUp 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }
    .hero p { 
      font-size: 1rem; 
      margin-bottom: 1.25rem;
      color: rgba(61,43,31,0.85);
      opacity: 0;
      transform: translateY(30px);
      animation: fadeUp 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.2s forwards;
    }
    .btn { 
      background: linear-gradient(180deg,var(--tomato),#d9441a); 
      color: #fff; 
      border: none; 
      padding: .7rem 1.6rem; 
      border-radius: 40px; 
      font-size: 1rem; 
      font-weight: 700; 
      cursor: pointer; 
      transition: var(--transition);
      position: relative;
      overflow: hidden;
      z-index: 1;
      opacity: 0;
      transform: translateY(30px);
      animation: fadeUp 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.4s forwards;
      box-shadow: 0 10px 20px rgba(229,75,34,0.12);
    }
    .btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255,255,255,0.12);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
      z-index: -1;
    }
    .btn:hover::before {
      width: 300px;
      height: 300px;
    }
    .btn:hover { transform: translateY(-3px) scale(1.04); box-shadow: 0 14px 30px rgba(229, 75, 34, 0.2); }
    
    /* ---------- loader ---------- */
    .loader {
      text-align: center;
      padding: 2rem;
      color: var(--tomato);
      grid-column: 1/-1;
    }
    
    .loader i {
      font-size: 2rem;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .search-bar { 
      width: 90%; 
      max-width: 680px; 
      margin: 1.25rem auto; 
      padding: .9rem 1.2rem; 
      height:48px;
      border: 2px solid var(--cheese); 
      border-radius: 40px; 
      background: #fff; 
      color: var(--brown); 
      outline: none; 
      font-size: 1rem;
      transition: var(--transition);
      opacity: 0;
      transform: translateY(20px);
      animation: fadeUp 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.6s forwards;
      box-shadow: 0 6px 18px rgba(250, 205, 88, 0.06);
    }
    .search-bar::placeholder{ color: rgba(61,43,31,0.45); }
    .search-bar:focus { 
      border-color: var(--tomato); 
      box-shadow: 0 8px 24px rgba(229, 75, 34, 0.12);
      transform: translateY(-2px);
    }

    /* ---------- tabs ---------- */
    .tabs { 
      display: flex; 
      flex-wrap: nowrap; 
      gap: .5rem; 
      justify-content: center; 
      padding: 1rem; 
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    .tabs::-webkit-scrollbar { height: 6px }
    .tabs::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.08); border-radius: 6px }
    .tabs::after { display:none; }
    .tab { 
      background: #fff; 
      color: var(--brown); 
      padding: .5rem 1rem; 
      border-radius: 40px; 
      cursor: pointer; 
      font-weight: 700; 
      transition: var(--transition); 
      border: 1px solid rgba(61,43,31,0.06);
      box-shadow: 0 6px 18px rgba(20,20,20,0.03);
      white-space: nowrap;
      position: relative;
    }
    .tab.active, .tab:hover { 
      border-color: transparent; 
      background: linear-gradient(180deg,var(--tomato),#d9441a); 
      color: #fff; 
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(229, 75, 34, 0.2);
    }

    /* ---------- menu ---------- */
    .menu-grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); 
      gap: 1.75rem; 
      padding: 1rem 1.25rem 2rem;
    }
    .card { 
      background: #fff; 
      border-radius: 16px; 
      overflow: hidden; 
      display: flex; 
      flex-direction: column; 
      transition: all 0.4s cubic-bezier(0.22, 1, 0.36, 1); 
      box-shadow: 0 8px 30px rgba(0,0,0,.06);
      opacity: 0;
      transform: translateY(20px) scale(0.98);
      animation: cardAppear 0.5s cubic-bezier(0.22, 1, 0.36, 1) forwards;
      position: relative;
    }
    .card.visible {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
    .card:hover { 
      transform: translateY(-8px) scale(1.02); 
      box-shadow: 0 18px 40px rgba(0,0,0,.14);
    }
    .card:hover .card-title {
      color: var(--tomato);
      transition: color 0.25s;
    }
    /* –ö–∞—Ä—Ç–∫–∏: –∞–¥–∞–ø—Ç–∏–≤–Ω–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è, –±–µ–∑ –æ–±—Ä—ñ–∑–∞–Ω–Ω—è –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö */
    .card picture, .card img { 
      width: 100%;
      display:block;
      transition: var(--transition);
      background: #f8f6f3;
      border-radius: 12px 12px 0 0 !important;
      object-fit: cover;
      aspect-ratio: 4/3;
    }
    @media (max-width: 600px) {
      .card picture, .card img {
        aspect-ratio: 1;
        object-fit: contain;
        border-radius: 12px !important;
      }
    }
    .card:hover picture img, .card:hover img { transform: scale(1.06); }

    /* size badge on top-right of card */
    .card .size-badge {
      position: absolute;
      top: 12px;
      right: 12px;
      background: linear-gradient(180deg,var(--tomato),#d9441a);
      color: #fff;
      font-size: 0.78rem;
      padding: 4px 8px;
      border-radius: 12px;
      box-shadow: 0 6px 16px rgba(229,75,34,0.16);
      z-index: 5;
    }

    .card-body { 
      padding: 1rem; 
      flex: 1; 
      display: flex; 
      flex-direction: column; 
      word-wrap: break-word;
      overflow-wrap: break-word;
    }
    .card-title { 
      font-size: 1.05rem; 
      margin-bottom: .25rem; 
      display: flex; 
      align-items: center; 
      gap: .5rem;
      line-height: 1.3;
    }

    .card-price { 
      font-weight: 700; 
      margin-bottom: .5rem; 
      color: var(--tomato);
      position: relative;
      display: inline-block;
      font-size: 1.05rem;
    }
    .promo-badge { 
      background: #ff6b6b; 
      color: #fff; 
      padding: 4px 8px; 
      border-radius: 12px; 
      font-size: .8rem; 
      margin-left: 8px;
      box-shadow: 0 6px 18px rgba(255,107,107,0.18);
    }
    .card-engagement {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
      margin: 0.5rem 0;
      flex-wrap: wrap;
    }
    .sold-chip {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      background: rgba(229,75,34,0.08);
      color: var(--brown);
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.85rem;
      font-weight: 600;
    }
    .like-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      border: 1px solid rgba(229,75,34,0.2);
      background: #fff;
      color: var(--tomato);
      border-radius: 999px;
      padding: 4px 12px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease, transform 0.2s ease;
      box-shadow: 0 6px 16px rgba(229,75,34,0.08);
    }
    .like-btn:hover {
      transform: translateY(-1px);
      background: rgba(229,75,34,0.08);
    }
    .like-btn.liked {
      background: linear-gradient(180deg,var(--tomato),#d9441a);
      color: #fff;
      border-color: transparent;
      box-shadow: 0 10px 24px rgba(229,75,34,0.22);
    }
    .like-btn i {
      pointer-events: none;
    }
    .like-count {
      min-width: 1.5rem;
      text-align: center;
      font-variant-numeric: tabular-nums;
    }
    .qty-row { 
      display: flex; 
      align-items: center; 
      gap: .6rem; 
      margin-top: auto; 
    }
    .qty-btn { 
      width: 34px; 
      height: 34px; 
      border-radius: 50%; 
      border: none; 
      background: var(--tomato); 
      color: #fff; 
      font-weight: bold; 
      cursor: pointer; 
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 6px 18px rgba(229,75,34,0.14);
    }
    .qty-btn:hover { 
      background: var(--brown); 
      transform: scale(1.06);
    }
    .qty-val { 
      min-width: 24px; 
      text-align: center; 
      font-weight: 700;
      transition: var(--transition);
    }

    /* ---------- —Å–∫–ª–∞–¥ ---------- */
    .ingredients {
      font-size: 0.85rem;
      color: #666;
      margin: 0.5rem 0;
      line-height: 1.4;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .ingredients.open {
      max-height: 200px;
      margin-bottom: 0.5rem;
    }
    .toggle-ingredients {
      background: none;
      border: none;
      color: var(--tomato);
      font-size: 0.8rem;
      cursor: pointer;
      padding: 0;
      margin-top: 0.25rem;
      display: flex;
      align-items: center;
      gap: 0.25rem;
      transition: var(--transition);
    }
    .toggle-ingredients:hover {
      color: var(--brown);
    }
    .toggle-ingredients i {
      font-size: 0.7rem;
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .toggle-ingredients.open i {
      transform: rotate(90deg);
    }

    /* ---------- –º–æ–¥–∞–ª—å–Ω—ñ –≤—ñ–∫–Ω–∞ –¥–ª—è —Å–∫–ª–∞–¥–Ω–∏—Ö —Ç–æ–≤–∞—Ä—ñ–≤ ---------- */
    .juice-modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1001;
      opacity: 0;
      visibility: hidden;
      transition: var(--transition);
      backdrop-filter: blur(5px);
    }
    .juice-modal.open {
      opacity: 1;
      visibility: visible;
    }
    .juice-content {
      background: #fff;
      color: var(--brown);
      width: 90%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      border-radius: var(--radius);
      padding: 1.5rem;
      position: relative;
      animation: modalSlide 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .juice-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 1rem;
      margin: 1rem 0;
    }
    .juice-card {
      background: #f9f9f9;
      border-radius: 12px;
      padding: 0.75rem;
      text-align: center;
      transition: var(--transition);
      border: 2px solid transparent;
      opacity: 0;
      transform: translateY(20px);
      animation: cardAppear 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }
    .juice-card.visible {
      opacity: 1;
      transform: translateY(0);
    }
    .juice-card:hover {
      border-color: var(--cheese);
      transform: translateY(-5px) scale(1.05);
    }
    .juice-card.selected {
      border-color: var(--olive);
      background: #f0f7f0;
    }
    .juice-card img {
      width: 100%;
      aspect-ratio: 1;
      object-fit: contain;
      border-radius: 8px;
      margin-bottom: 0.5rem;
      transition: var(--transition);
    }
    .juice-card:hover img {
      transform: scale(1.1);
    }
    .juice-card h4 {
      font-size: 0.9rem;
      margin-bottom: 0.25rem;
    }
    .juice-card .price {
      color: var(--tomato);
      font-weight: 600;
      font-size: 0.9rem;
    }
    .juice-card .qty-row {
      justify-content: center;
      margin-top: 0.5rem;
    }
    .juice-card .qty-btn {
      width: 25px;
      height: 25px;
      font-size: 0.8rem;
    }

    /* ---------- cart ---------- */
    .cart-btn { 
      position: fixed; 
      bottom: 1.25rem; 
      right: 1.25rem; 
      background: linear-gradient(180deg,var(--tomato),#d9441a); 
      color: #fff; 
      width: 68px; 
      height: 68px; 
      border-radius: 50%; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      font-size: 1.35rem; 
      box-shadow: 0 18px 45px rgba(229, 75, 34, 0.24); 
      z-index: 900; 
      transition: var(--transition); 
      cursor: pointer;
      animation: float 3s ease-in-out infinite;
      border: 3px solid rgba(255,255,255,0.06);
    }
    .cart-btn:hover { 
      transform: translateY(-6px) scale(1.06); 
      box-shadow: 0 24px 60px rgba(229, 75, 34, 0.32);
      animation: none;
    }
    .cart-btn.added {
      animation: cartPulse 0.5s ease;
    }
    .cart-badge { 
      position: absolute; 
      top: -6px; 
      right: -6px; 
      background: var(--cheese); 
      color: var(--brown); 
      width: 24px; 
      height: 24px; 
      border-radius: 50%; 
      font-size: .75rem; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      font-weight: bold;
      transition: var(--transition);
      box-shadow: 0 6px 14px rgba(0,0,0,0.12);
      border: 2px solid rgba(255,255,255,0.3);
    }
    .cart-badge.pulse {
      animation: badgePulse 0.5s ease;
    }

    /* ---------- modals ---------- */
    .cart-modal { 
      position: fixed; 
      inset: 0; 
      background: rgba(0,0,0,.6); 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      z-index: 1000; 
      opacity: 0; 
      visibility: hidden; 
      transition: var(--transition);
      backdrop-filter: blur(5px);
    }
    .cart-modal.open { 
      opacity: 1; 
      visibility: visible; 
    }
    .cart-content { 
      background: #fff; 
      color: var(--brown); 
      width: 90%; 
      max-width: 500px; 
      max-height: 90vh; 
      overflow-y: auto; 
      border-radius: var(--radius); 
      padding: 1.5rem; 
      position: relative; 
      animation: modalSlide 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* ---------- cart items ---------- */
    .cart-items-container {
      margin: 1.5rem 0;
      max-height: 300px;
      overflow-y: auto;
      padding-right: 0.5rem;
    }

    .cart-items-container::-webkit-scrollbar {
      width: 6px;
    }

    .cart-items-container::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }

    .cart-items-container::-webkit-scrollbar-thumb {
      background: var(--tomato);
      border-radius: 10px;
    }

    .cart-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem;
      background: #f9f9f9;
      border-radius: var(--radius);
      margin-bottom: 0.75rem;
      border-left: 4px solid var(--tomato);
      transition: var(--transition);
      animation: cartItemAppear 0.3s ease-out;
    }

    .cart-item:hover {
      transform: translateX(5px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .cart-item-info {
      flex: 1;
      margin-right: 1rem;
    }

    .cart-item-name {
      font-weight: 600;
      margin-bottom: 0.25rem;
      color: var(--brown);
    }

    .cart-item-variant {
      font-size: 0.85rem;
      color: #777;
      margin-bottom: 0.25rem;
    }

    .cart-item-price {
      color: var(--tomato);
      font-weight: 600;
      font-size: 1.1rem;
    }

    .cart-item-controls {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .cart-item-qty {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: #fff;
      padding: 0.25rem 0.5rem;
      border-radius: 50px;
      border: 2px solid var(--cheese);
    }

    .cart-item-total {
      min-width: 80px;
      text-align: right;
      font-weight: 700;
      color: var(--olive);
      font-size: 1.1rem;
    }

    .cart-item-remove {
      background: none;
      border: none;
      color: #ff6b6b;
      cursor: pointer;
      font-size: 1.2rem;
      transition: var(--transition);
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .cart-item-remove:hover {
      background: rgba(255, 107, 107, 0.1);
      transform: rotate(90deg);
    }

    .empty-cart {
      text-align: center;
      padding: 3rem 1rem;
      color: #666;
    }

    .empty-cart i {
      font-size: 3rem;
      margin-bottom: 1rem;
      color: var(--cheese);
      opacity: 0.5;
    }

    .cart-summary {
      background: linear-gradient(135deg, #f9f9f9, #fff);
      border-radius: var(--radius);
      padding: 1.5rem;
      margin-top: 1.5rem;
      border: 2px solid var(--cheese);
    }

    .cart-summary-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.75rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px dashed #ddd;
    }

    .cart-summary-row:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    .cart-total-label {
      font-weight: 600;
      color: var(--brown);
    }

    .cart-total-value {
      font-weight: 700;
      color: var(--tomato);
      font-size: 1.3rem;
    }

    /* ---------- animations ---------- */
    @keyframes fadeUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    @keyframes cardAppear {
      from {
        opacity: 0;
        transform: translateY(30px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    @keyframes modalSlide {
      from {
        transform: translateY(40px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    @keyframes float {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-10px);
      }
    }

    @keyframes pulse {
      0%, 100% {
        opacity: 1;
        transform: scale(1);
      }
      50% {
        opacity: 0.8;
        transform: scale(1.05);
      }
    }

    @keyframes badgePulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.3);
      }
    }

    @keyframes cartPulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.2);
      }
    }

    @keyframes rotate {
      from {
        transform: rotate(0deg);
      }
      to {
        transform: rotate(360deg);
      }
    }

    @keyframes tabLine {
      0%, 100% {
        width: 100px;
      }
      50% {
        width: 150px;
      }
    }

    @keyframes logoPulse {
      0%, 100% {
        opacity: 0.7;
        transform: translateY(-50%) scale(1);
      }
      50% {
        opacity: 1;
        transform: translateY(-50%) scale(1.1);
      }
    }

    @keyframes flyToCart {
      0% {
        opacity: 1;
        transform: translate(0, 0) scale(1) rotate(0deg);
      }
      70% {
        opacity: 0.7;
      }
      100% {
        opacity: 0;
        transform: translate(var(--tx), var(--ty)) scale(0.1) rotate(180deg);
      }
    }

    @keyframes cartItemAppear {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    /* ---------- footer ---------- */
    footer { 
      padding: 2rem 1rem; 
      text-align: center; 
      background: #fff; 
      margin-top: 2rem; 
      font-size: .9rem; 
      position: relative;
      overflow: hidden;
    }
    footer::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--tomato), var(--cheese), var(--olive));
      border-radius: 3px;
      animation: gradientShift 3s infinite alternate;
    }
    footer a { 
      color: var(--tomato); 
      transition: var(--transition);
      position: relative;
    }
    footer a::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 0;
      height: 1px;
      background: var(--tomato);
      transition: width 0.3s;
    }
    footer a:hover::after {
      width: 100%;
    }
    
    /* Social links –≤ —Ñ—É—Ç–µ—Ä—ñ */
    #social-links-footer a::after {
      display: none; /* –ü—Ä–∏–±—Ä–∞—Ç–∏ –ø—ñ–¥–∫—Ä–µ—Å–ª–µ–Ω–Ω—è –¥–ª—è —ñ–∫–æ–Ω–æ–∫ */
    }
    #social-links-footer .fa-facebook { color: #1877f2; }
    #social-links-footer .fa-instagram { color: #e4405f; }
    #social-links-footer .fa-twitter { color: #1da1f2; }
    #social-links-footer .fa-telegram { color: #0088cc; }
    #social-links-footer .fa-viber { color: #665cac; }
    #social-links-footer .fa-youtube { color: #ff0000; }
    #social-links-footer .fa-tiktok { color: #000; }
    #social-links-footer .fa-linkedin { color: #0077b5; }
    #social-links-footer .fa-pinterest { color: #bd081c; }
    #social-links-footer .fa-whatsapp { color: #25d366; }
    #social-links-footer .fa-facebook-messenger { color: #0084ff; }
    
    .contacts-section {
      padding: 3rem 1rem 3.5rem;
      background: linear-gradient(180deg, #fff9f3 0%, #fff3e9 100%);
    }
    .contacts-wrapper {
      max-width: 1080px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 2.5rem;
    }
    .contacts-heading {
      text-align: center;
      max-width: 720px;
      margin: 0 auto;
    }
    .contacts-heading h2 {
      font-size: clamp(2.2rem, 4vw, 2.9rem);
      color: var(--brown);
      margin-bottom: 0.75rem;
    }
    .contacts-heading p {
      font-size: 1rem;
      color: rgba(61,43,31,0.7);
      margin: 0 auto;
      line-height: 1.6;
    }
    .contact-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 1.1rem;
    }
    .contact-card {
      background: #fff;
      border-radius: 22px;
      padding: 1.3rem 1.5rem;
      display: flex;
      gap: 1rem;
      align-items: flex-start;
      box-shadow: 0 20px 40px rgba(229,75,34,0.08);
      border: 1px solid rgba(229,75,34,0.08);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .contact-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 24px 50px rgba(229,75,34,0.12);
    }
    .contact-icon {
      width: 48px;
      height: 48px;
      border-radius: 16px;
      background: rgba(229,75,34,0.12);
      color: var(--tomato);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.4rem;
      flex-shrink: 0;
    }
    .contact-info {
      text-align: left;
      flex: 1;
    }
    .contact-label {
      display: block;
      font-weight: 700;
      color: var(--brown);
      margin-bottom: 0.35rem;
      font-size: 0.95rem;
    }
    .contact-value {
      margin: 0;
      color: rgba(61,43,31,0.85);
      font-size: 0.97rem;
      line-height: 1.55;
      word-break: break-word;
    }
    .contact-link {
      color: var(--tomato);
      font-weight: 600;
      font-size: 1.05rem;
      text-decoration: none;
      transition: color 0.2s ease;
    }
    .contact-link:hover {
      color: #ff7640;
    }
    .contact-social {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
      align-items: center;
    }
    .contact-social a {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.4rem 0.8rem;
      border-radius: 999px;
      background: rgba(229,75,34,0.08);
      color: var(--tomato);
      font-weight: 600;
      font-size: 0.9rem;
      transition: transform 0.2s ease, background 0.2s ease;
    }
    .contact-social a:hover {
      transform: translateY(-2px);
      background: rgba(229,75,34,0.18);
    }
    .contact-placeholder {
      color: rgba(61,43,31,0.55);
      font-size: 0.9rem;
    }
    .contact-map-card {
      background: #fff;
      border-radius: 26px;
      padding: 1.8rem;
      box-shadow: 0 24px 60px rgba(229,75,34,0.12);
      border: 1px solid rgba(229,75,34,0.08);
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      align-items: center;
    }
    .contact-map-frame {
      width: 100%;
      min-height: 320px;
      border: 0;
      border-radius: 18px;
      box-shadow: inset 0 0 0 1px rgba(229,75,34,0.05);
    }
    .contact-map-actions {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
      justify-content: center;
    }
    .contact-map-actions .btn {
      padding: 0.65rem 1.4rem;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
    }
    .btn-outline {
      background: transparent;
      border: 2px solid var(--tomato);
      color: var(--tomato);
      padding: 0.65rem 1.4rem;
      border-radius: 999px;
      font-weight: 600;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
    }
    .btn-outline:hover {
      background: var(--tomato);
      color: #fff;
    }

    .about-section {
      padding: 2.5rem 1rem;
      text-align: center;
      max-width: 960px;
      margin: 0 auto 2.5rem;
    }
    .about-section h2 {
      font-size: clamp(2rem, 4vw, 2.8rem);
      margin-bottom: 1rem;
      color: var(--tomato);
    }
    .about-description {
      font-size: 1.05rem;
      color: rgba(61,43,31,0.9);
      margin-bottom: 1.5rem;
      line-height: 1.6;
    }
    .about-highlights {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.75rem;
      list-style: none;
      padding: 0;
      margin: 0 auto 1.5rem;
      max-width: 720px;
    }
    .about-highlights li {
      background: #fff;
      border-radius: 999px;
      padding: 0.5rem 1.2rem;
      border: 1px solid rgba(229,75,34,0.12);
      box-shadow: 0 4px 16px rgba(229,75,34,0.08);
      font-weight: 600;
      color: var(--brown);
      font-size: 0.95rem;
    }

    .recommendations-section {
      padding: 2.5rem 1rem;
      background: #fff8f0;
    }
    .recommendations-header {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.75rem;
      max-width: 1120px;
      margin: 0 auto 1.5rem;
      text-align: center;
    }
    .recommendations-header h2 {
      font-size: clamp(2rem, 4vw, 2.6rem);
      color: var(--brown);
      margin: 0;
    }
    .recommendations-controls {
      display: flex;
      gap: 0.5rem;
      justify-content: center;
      width: 100%;
    }
    .carousel-btn {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      border: none;
      background: #fff;
      color: var(--tomato);
      box-shadow: 0 10px 24px rgba(229,75,34,0.18);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.2s ease, background 0.2s ease;
    }
    .carousel-btn:hover {
      transform: translateY(-2px);
      background: var(--tomato);
      color: #fff;
    }
    .carousel-btn:disabled {
      opacity: 0.4;
      cursor: default;
      box-shadow: none;
    }
    .recommendations-wrapper {
      position: relative;
      overflow: hidden;
      max-width: 1120px;
      margin: 0 auto;
    }
    .recommendations-track {
      display: grid;
      grid-auto-flow: column;
      grid-auto-columns: minmax(260px, 1fr);
      gap: 1.25rem;
      padding-bottom: 0.5rem;
      overflow-x: auto;
      scroll-behavior: smooth;
      cursor: pointer;
      position: relative;
      transition: transform 0.25s ease, box-shadow 0.25s ease;
    }
    .recommendation-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 20px 44px rgba(229,75,34,0.18);
    }
    .recommendation-card:focus-visible {
      outline: 3px solid rgba(229,75,34,0.35);
      outline-offset: 4px;
    }
    
    .recommendations-track::-webkit-scrollbar {
      height: 6px;
    }
    .recommendations-track::-webkit-scrollbar-thumb {
      background: rgba(229,75,34,0.25);
      border-radius: 999px;
    }
    .card.highlight-target {
      box-shadow: 0 0 0 4px rgba(229,75,34,0.2), 0 22px 46px rgba(229,75,34,0.25);
      transform: translateY(-4px) scale(1.02);
    }
    .recommendation-card {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 16px 36px rgba(229,75,34,0.12);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      scroll-snap-align: start;
    }
    .recommendation-card picture,
    .recommendation-card img {
      width: 100%;
      aspect-ratio: 4/3;
      object-fit: cover;
    }
    .recommendation-body {
      padding: 1.25rem;
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
    }
    .recommendation-body h3 {
      font-size: 1.15rem;
      color: var(--brown);
      margin: 0;
    }
    .recommendation-meta {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.95rem;
      color: rgba(61,43,31,0.7);
    }
    .recommendations-empty {
      max-width: 960px;
      margin: 1rem auto 0;
      text-align: center;
      color: rgba(61,43,31,0.55);
      padding: 1.5rem;
      border-radius: 16px;
      border: 2px dashed rgba(229,75,34,0.15);
      background: #fff;
    }

    .gallery-section {
      padding: 2.5rem 1rem 3rem;
    }
    .gallery-section h2 {
      text-align: center;
      font-size: clamp(2rem, 4vw, 2.6rem);
      margin-bottom: 1.8rem;
      color: var(--brown);
    }
    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem;
      max-width: 960px;
      margin: 0 auto;
    }
    .gallery-card {
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 12px 28px rgba(0,0,0,0.08);
      position: relative;
      background: #fff;
    }
    .gallery-card img {
      width: 100%;
      height: 220px;
      object-fit: cover;
      display: block;
      transition: transform 0.4s ease;
    }
    .gallery-card img:hover {
      transform: scale(1.05);
    }
    .gallery-caption {
      padding: 0.8rem 1rem 1rem;
      font-size: 0.95rem;
      color: rgba(61,43,31,0.7);
    }
    .gallery-empty {
      grid-column: 1 / -1;
      text-align: center;
      color: rgba(61,43,31,0.55);
      padding: 1.5rem;
      border-radius: 16px;
      border: 2px dashed rgba(229,75,34,0.15);
      background: #fff8f0;
    }

    /* ---------- rating ---------- */
    .review-cta-section {
      max-width: 960px;
      margin: 3rem auto 2.5rem;
      padding: 2.25rem 1.75rem;
      border-radius: 24px;
      background: linear-gradient(135deg, rgba(255,243,236,0.95), rgba(255,228,210,0.95));
      box-shadow: 0 18px 42px rgba(229,75,34,0.12);
      text-align: center;
    }
    .review-cta-title {
      font-size: clamp(1.8rem, 4vw, 2.4rem);
      color: var(--brown);
      margin-bottom: 0.8rem;
    }
    .review-hint-text {
      color: rgba(61,43,31,0.75);
      margin-bottom: 1.25rem;
      font-size: 1rem;
    }
    .review-cta-button {
      display: inline-flex;
      align-items: center;
      gap: 0.6rem;
    }
    .star-rating {
      font-size: 1.6rem;
      color: var(--cheese);
      margin-top: 1.2rem;
      animation: fadeUp 0.5s;
      display: flex;
      justify-content: center;
      gap: 0.35rem;
    }
    .star-rating i {
      cursor: pointer;
      transition: var(--transition);
      transform-origin: center;
    }
    .star-rating i.active, .star-rating i:hover {
      color: var(--tomato);
      transform: scale(1.2);
    }

    /* ---------- –ø–ª–∞–≤–∞—é—á—ñ —ñ–∫–æ–Ω–∫–∏ ---------- */
    .floating-icons {
      position: fixed;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
      z-index: -1;
    }

    .floating-icons i {
      position: absolute;
      bottom: -40px;
      font-size: 1.5rem;
      color: var(--cheese);
      opacity: 0.12;
      animation: float 20s linear infinite;
      transition: var(--transition);
    }

    .floating-icons i:hover {
      opacity: 0.2;
      transform: scale(1.2);
    }

    /* ---------- –ª–µ—Ç—è—á–∏–π –µ–ª–µ–º–µ–Ω—Ç ---------- */
    .flying-item {
      position: fixed;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--tomato);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.5rem;
      z-index: 10000;
      pointer-events: none;
      animation: flyToCart 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
      box-shadow: 0 4px 12px rgba(229, 75, 34, 0.3);
    }

    .sansgoga{
      text-align: center;
    }

    /* ---------- form styles ---------- */
    .form-field { 
      width: 100%; 
      padding: .75rem 1rem; 
      margin-bottom: .75rem; 
      border: 2px solid var(--cheese); 
      border-radius: var(--radius); 
      font-size: 1rem; 
      outline: none; 
      transition: var(--transition);
      background: #fff;
    }
    .form-field:focus { 
      border-color: var(--tomato); 
      box-shadow: 0 0 0 3px rgba(229, 75, 34, 0.1);
    }
    .checkout-btn { 
      width: 100%; 
      padding: 1rem; 
      background: var(--olive); 
      color: #fff; 
      border: none; 
      border-radius: var(--radius); 
      font-size: 1.1rem; 
      font-weight: 600; 
      cursor: pointer; 
      transition: var(--transition);
      margin-top: 1rem;
    }
    .checkout-btn:hover { 
      background: var(--brown); 
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    @keyframes gradientShift {
      0% {
        background-position: 0% 50%;
      }
      100% {
        background-position: 100% 50%;
      }
    }

    /* ---------- –∞–¥–∞–ø—Ç–∏–≤ ---------- */
    @media(max-width: 600px) { 
      .menu-grid { grid-template-columns: 1fr; } 
      .hero { min-height: 50vh; } 
      .hero h1 { 
        font-size: 1.5rem; 
        line-height: 1.3;
        word-wrap: break-word;
        overflow-wrap: break-word;
        padding: 0 1rem;
      } 
      .hero p {
        font-size: 0.9rem;
        padding: 0 1rem;
        word-wrap: break-word;
        overflow-wrap: break-word;
      }
      .tabs { 
        overflow-x: auto; 
        justify-content: center; 
        padding-bottom: .5rem;
        -webkit-overflow-scrolling: touch;
      }
      .tab {
        font-size: 0.9rem;
        padding: 0.4rem 0.8rem;
        white-space: nowrap;
      }
      .cart-btn {
        width: 50px;
        height: 50px;
        font-size: 1rem;
      }
      .cart-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.75rem;
      }
      .cart-item-info {
        margin-right: 0;
        width: 100%;
        word-wrap: break-word;
        overflow-wrap: break-word;
      }
      .cart-item-controls {
        width: 100%;
        justify-content: space-between;
      }
      .card-title {
        font-size: 1rem;
        line-height: 1.3;
      }
      .card-price {
        font-size: 0.95rem;
      }
      .card-body p {
        font-size: 0.85rem;
        word-wrap: break-word;
        overflow-wrap: break-word;
      }
      section {
        padding-left: 0.5rem;
        padding-right: 0.5rem;
      }
      .contacts-wrapper {
        gap: 2rem;
      }
      .contact-cards {
        gap: 0.85rem;
      }
      .contact-card {
        padding: 1rem 1.15rem;
      }
      .contact-icon {
        width: 40px;
        height: 40px;
        font-size: 1.1rem;
      }
      .contact-map-frame {
        min-height: 220px;
      }
    }
  </style>
</head>
<body>
  <div class="floating-icons" id="floatIcons"></div>

  <header id="mainHeader">
    <div class="logo">
      <img src="/icons/icon-192.svg" id="app-icon" class="app-icon" alt="Kisso app icon" onerror="this.onerror=null;this.src='/att/kisso-logo.svg'">
      <img src="/att/kisso-logo.svg" alt="Kisso" class="site-logo" id="site-logo">
      <span id="brand-text" class="brand-text" style="margin-left:0.6rem;">Kisso</span>
    </div>
    <div class="burger" onclick="toggleNav()">
      <span></span>
      <span></span>
      <span></span>
    </div>
    <nav id="main-nav">
      <a href="#menu">–ú–µ–Ω—é</a>
      <a href="#contacts">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a>
      <a href="#about">–ü—Ä–æ –Ω–∞—Å</a>
      <button id="pwa-install-btn" onclick="installPWA()" style="display:flex;align-items:center;gap:0.3rem;background:var(--tomato);color:#fff;border:none;padding:0.5rem 1rem;border-radius:20px;font-size:0.85rem;cursor:pointer;transition:var(--transition);" onmouseover="this.style.background='var(--brown)'" onmouseout="this.style.background='var(--tomato)'">
        <i class="fas fa-download"></i> –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏
      </button>
    </nav>
  </header>
  
  <main>
    <section class="hero">
      <h1 id="restaurant-name-header">–°–ø—Ä–∞–≤–∂–Ω—è —ñ—Ç–∞–ª—ñ–π—Å—å–∫–∞ –ø—ñ—Ü–∞ —É –ö–æ–ª–æ–º–∏—ó</h1>
      <p id="restaurant-phone-header">–î–æ—Å—Ç–∞–≤–∫–∞ —Ç–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–æ–ª–∏–∫—ñ–≤: +38 (066) 020-96-75</p>
      <a href="#menu" class="btn">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –º–µ–Ω—é</a>
    </section>
    
    <div class="sansgoga">
      <label for="searchInput" class="sr-only">–ü–æ—à—É–∫ —Å—Ç—Ä–∞–≤</label>
    <input type="text" class="search-bar" id="searchInput" placeholder="–ü–æ—à—É–∫ —Å—Ç—Ä–∞–≤..." aria-label="–ü–æ—à—É–∫ —Å—Ç—Ä–∞–≤">
    </div>
    
    <section id="menu">
      <div class="tabs">
        <!-- –ö–Ω–æ–ø–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π –≥–µ–Ω–µ—Ä—É—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ -->
      </div>

      <div class="menu-grid" id="menuGrid">
        <div class="loader"><i class="fas fa-spinner"></i><p>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–µ–Ω—é...</p></div>
      </div>
    </section>

    <div class="cart-btn" onclick="toggleCart()">
      <i class="fas fa-shopping-cart"></i>
      <span class="cart-badge" id="count">0</span>
    </div>
    
    <section id="recommendations" class="recommendations-section">
      <div class="recommendations-header">
        <h2 id="recommendations-title-site">–©–æ –∫–∞–∂—É—Ç—å –≥–æ—Å—Ç—ñ</h2>
        <div class="recommendations-controls" id="recommendations-controls">
          <button type="button" class="carousel-btn" id="recommendations-prev" aria-label="–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Ç–æ–≤–∞—Ä">
            <i class="fas fa-chevron-left"></i>
          </button>
          <button type="button" class="carousel-btn" id="recommendations-next" aria-label="–ù–∞—Å—Ç—É–ø–Ω–∏–π —Ç–æ–≤–∞—Ä">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
      <div class="recommendations-wrapper" id="recommendations-wrapper">
        <div id="recommendations-track" class="recommendations-track" role="list"></div>
      </div>
      <div id="recommendations-empty" class="recommendations-empty">–î–æ–¥–∞–π—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –≤ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ, —ñ –≤–æ–Ω–∏ –∑'—è–≤–ª—è—Ç—å—Å—è —Ç—É—Ç.</div>
    </section>

    <section id="review" class="review-cta-section">
      <h2 class="review-cta-title" id="review-cta-title">–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è –≤—Ä–∞–∂–µ–Ω–Ω—è–º–∏</h2>
      <p class="review-hint-text" id="review-hint">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å, —â–æ–± –∑–∞–ª–∏—à–∏—Ç–∏ –≤—ñ–¥–≥—É–∫ —É Google. –Ø–∫—â–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–µ, –æ—Ü—ñ–Ω—ñ—Ç—å –Ω–∞—Å —Ç—É—Ç.</p>
      <button type="button" class="btn review-cta-button" id="review-cta-button" onclick="openReviewLink(event)">
        <i class="fas fa-star"></i>
        <span>–û—Ü—ñ–Ω–∏—Ç–∏ –∑–∞–∫–ª–∞–¥</span>
      </button>
      <div class="star-rating" id="starRating" style="display:none">
        <i class="fa-regular fa-star" data-s="1"></i>
        <i class="fa-regular fa-star" data-s="2"></i>
        <i class="fa-regular fa-star" data-s="3"></i>
        <i class="fa-regular fa-star" data-s="4"></i>
        <i class="fa-regular fa-star" data-s="5"></i>
      </div>
    </section>

    <section id="about" class="about-section">
      <h2>–ü—Ä–æ –Ω–∞—Å</h2>
      <p id="about-description-text" class="about-description">Kisso ‚Äì —Ü–µ —Å–º–∞—á–Ω–∞ –ø—ñ—Ü–∞ —Ç–∞ —ñ—Ç–∞–ª—ñ–π—Å—å–∫—ñ —Å—Ç—Ä–∞–≤–∏. –ì–æ—Ç—É—î–º–æ –∑ –ª—é–±–æ–≤'—é!</p>
      <ul id="about-highlights-list" class="about-highlights">
        <li>–ü—ñ—á –Ω–∞ –¥—Ä–æ–≤–∞—Ö</li>
        <li>–°–≤—ñ–∂—ñ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏</li>
        <li>–®–≤–∏–¥–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</li>
      </ul>
    </section>

    <section id="gallery" class="gallery-section">
      <h2>–ì–∞–ª–µ—Ä–µ—è</h2>
      <div id="gallery-grid" class="gallery-grid">
        <div class="gallery-empty">–°–∫–æ—Ä–æ —Ç—É—Ç –∑'—è–≤–ª—è—Ç—å—Å—è —Ñ–æ—Ç–æ –∑ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—É.</div>
      </div>
    </section>

    <section id="contacts" class="contacts-section">
      <div class="contacts-wrapper">
        <div class="contacts-heading">
          <h2>–ö–æ–Ω—Ç–∞–∫—Ç–∏</h2>
          <p id="contacts-subtitle">–ó–∞–≤—ñ—Ç–∞–π—Ç–µ –¥–æ –Ω–∞—Å –∞–±–æ –∑–≤'—è–∂—ñ—Ç—å—Å—è –∑ –∫–æ–º–∞–Ω–¥–æ—é Kisso –±—É–¥—å-—è–∫–∏–º –∑—Ä—É—á–Ω–∏–º —Å–ø–æ—Å–æ–±–æ–º.</p>
        </div>
        <div class="contact-cards">
          <div class="contact-card">
            <div class="contact-icon" aria-hidden="true"><i class="fas fa-location-dot"></i></div>
            <div class="contact-info">
              <span class="contact-label">–ê–¥—Ä–µ—Å–∞</span>
              <p class="contact-value" id="restaurant-address-contact">–ö–æ–ª–æ–º–∏—è, –≤—É–ª. –Ü–≤–∞–Ω–∞ –ú–∏–∫–æ–ª–∞–π—á—É–∫–∞, 78200</p>
            </div>
          </div>
          <div class="contact-card">
            <div class="contact-icon" aria-hidden="true"><i class="fas fa-phone"></i></div>
            <div class="contact-info">
              <span class="contact-label">–¢–µ–ª–µ—Ñ–æ–Ω</span>
              <a class="contact-link" id="restaurant-phone-contact" href="tel:+380660209675">+38 (066) 020-96-75</a>
            </div>
          </div>
          <div class="contact-card" id="contact-email-card">
            <div class="contact-icon" aria-hidden="true"><i class="fas fa-envelope"></i></div>
            <div class="contact-info">
              <span class="contact-label">–ï–ª. –ø–æ—à—Ç–∞</span>
              <a class="contact-link" id="restaurant-email-contact" href="mailto:info@kisso.example">info@kisso.example</a>
            </div>
          </div>
          <div class="contact-card">
            <div class="contact-icon" aria-hidden="true"><i class="fas fa-clock"></i></div>
            <div class="contact-info">
              <span class="contact-label">–†–æ–±–æ—á–∏–π —á–∞—Å</span>
              <p class="contact-value" id="restaurant-hours-contact">–ü–Ω‚Äì–ù–¥: 10:00‚Äì22:00</p>
            </div>
          </div>
          <div class="contact-card" id="contact-social-card">
            <div class="contact-icon" aria-hidden="true"><i class="fas fa-hashtag"></i></div>
            <div class="contact-info">
              <span class="contact-label">–ú–∏ –≤ —Å–æ—Ü–º–µ—Ä–µ–∂–∞—Ö</span>
              <div class="contact-social" id="contacts-social">
                <span class="contact-placeholder">–î–æ–¥–∞–π—Ç–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –≤ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ, —ñ –≤–æ–Ω–∏ –∑'—è–≤–ª—è—Ç—å—Å—è —Ç—É—Ç.</span>
              </div>
            </div>
          </div>
        </div>
        <div class="contact-map-card">
          <iframe class="contact-map-frame" loading="lazy"
                  src="https://www.openstreetmap.org/export/embed.html?bbox=25.05869328975678%2C48.51547617244124%2C25.061203837394718%2C48.516689673233195&amp;layer=mapnik&amp;marker=48.51608292647055%2C25.059948563575745"
                  allowfullscreen aria-label="–ú–∏ –Ω–∞ –º–∞–ø—ñ"></iframe>
          <div class="contact-map-actions">
            <a class="btn-outline" id="contact-route-btn" href="https://www.google.com/maps/place/–≤—É–ª–∏—Ü—è+–Ü–≤–∞–Ω–∞+–ú–∏–∫–æ–ª–∞–π—á—É–∫–∞,+–ö–æ–ª–æ–º–∏—è,+–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫–∞+–æ–±–ª–∞—Å—Ç—å,+78200" target="_blank" rel="noopener">
              <i class="fas fa-route"></i> –ú–∞—Ä—à—Ä—É—Ç
            </a>
            <a class="btn" id="contact-call-btn" href="tel:+380660209675">
              <i class="fas fa-phone-volume"></i> –ü–æ–¥–∑–≤–æ–Ω–∏—Ç–∏
            </a>
          </div>
        </div>
      </div>
    </section>

  </main>

  <footer>
    <p>¬© 2025 <span id="restaurant-name-footer">Kisso</span> ‚Ä¢ <a href="tel:+380660209675" id="restaurant-phone-footer">+38 (066) 020-96-75</a></p>
    <p>‚è∞ <span id="restaurant-hours-footer">–ü–Ω‚Äì–ù–¥: 10:00‚Äì22:00</span></p>
    <div id="social-links-footer" style="font-size:1.5rem;margin-top:.7rem;display:flex;gap:.8rem;justify-content:center;flex-wrap:wrap">
      <!-- –°–æ—Ü–º–µ—Ä–µ–∂—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å -->
    </div>
  </footer>

  <!-- Cart Modal -->
  <div class="cart-modal" id="cartModal" role="dialog" aria-modal="true" aria-labelledby="cartTitle">
    <div class="cart-content">
      <button onclick="toggleCart()" style="align-self:flex-end;background:none;border:none;font-size:1.5rem;cursor:pointer;position:absolute;top:1rem;right:1rem;z-index:10" aria-label="–ó–∞–∫—Ä–∏—Ç–∏">‚úñ</button>
      <h2 id="cartTitle">–ö–æ—à–∏–∫</h2>
      
      <div class="cart-items-container" id="cartItems">
        <!-- Cart items will be inserted here -->
      </div>
      
      <div class="cart-summary" id="cartSummary" style="display:none">
        <div class="cart-summary-row">
          <span class="cart-total-label">–°—É–º–∞:</span>
          <span class="cart-total-value" id="cartTotal">0 –≥—Ä–Ω</span>
        </div>
        
        <!-- –ü—Ä–æ–º–æ–∫–æ–¥ (–∑–≥–æ—Ä—Ç—É–≤–∞–Ω–∏–π) -->
        <div class="promocode-section" style="margin-top:1rem;background:#fff8f0;border-radius:12px;overflow:hidden">
          <div onclick="togglePromoSection()" style="padding:0.75rem 1rem;cursor:pointer;display:flex;align-items:center;justify-content:space-between;user-select:none">
            <span style="font-weight:600;color:#666;font-size:0.95rem">üéÅ –Ñ –ø—Ä–æ–º–æ–∫–æ–¥?</span>
            <span id="promoToggleIcon" style="transition:transform 0.3s;font-size:0.8rem;color:#999">‚ñº</span>
          </div>
          <div id="promoContent" style="display:none;padding:0 1rem 1rem 1rem">
            <div style="display:flex;gap:0.5rem">
              <label for="promocodeInput" class="sr-only">–ü—Ä–æ–º–æ–∫–æ–¥</label>
        <input type="text" id="promocodeInput" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥" aria-label="–ü—Ä–æ–º–æ–∫–æ–¥" 
                style="flex:1;padding:0.7rem;border:1px solid #ddd;border-radius:8px;text-transform:uppercase;font-weight:600">
              <button type="button" onclick="applyPromocode()" 
                style="padding:0.7rem 1rem;background:var(--tomato);color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:600">
                –û–ö
              </button>
            </div>
            <div id="promocodeResult" style="margin-top:0.5rem;font-size:0.9rem"></div>
          </div>
        </div>
        
        <!-- –ó–Ω–∏–∂–∫–∞ —Ç–∞ –ø—ñ–¥—Å—É–º–æ–∫ -->
        <div id="discountRow" style="display:none;margin-top:0.75rem" class="cart-summary-row">
          <span style="color:#2e7d32">–ó–Ω–∏–∂–∫–∞:</span>
          <span id="discountAmount" style="color:#2e7d32;font-weight:600">-0 –≥—Ä–Ω</span>
        </div>
        <div id="finalTotalRow" style="display:none;margin-top:0.5rem;padding-top:0.75rem;border-top:2px solid var(--tomato)" class="cart-summary-row">
          <span style="font-weight:700;font-size:1.1rem">–î–æ —Å–ø–ª–∞—Ç–∏:</span>
          <span id="finalTotal" style="font-weight:700;font-size:1.2rem;color:var(--tomato)">0 –≥—Ä–Ω</span>
        </div>
      </div>
      
      <form id="orderForm" onsubmit="handleOrder(event)" style="margin-top:1.5rem">
        <select name="deliveryType" class="form-field" required onchange="toggleFields(this)">
          <option value="" disabled selected>–û–±–µ—Ä—ñ—Ç—å —Å–ø–æ—Å—ñ–±</option>
          <option value="delivery">–î–æ—Å—Ç–∞–≤–∫–∞</option>
          <option value="takeaway">–ù–∞ –≤–∏–Ω—ñ—Å</option>
          <option value="cafe">–£ –∫–∞—Ñ–µ</option>
        </select>
        <label for="fieldName" class="sr-only">–Ü–º'—è</label>
        <input name="name" id="fieldName" class="form-field" placeholder="–Ü–º'—è" required autocomplete="name" aria-label="–Ü–º'—è">
        <label for="fieldPhone" class="sr-only">–¢–µ–ª–µ—Ñ–æ–Ω</label>
        <input name="phone" id="fieldPhone" class="form-field" type="tel" pattern="[0-9+]{10,}" placeholder="+380..." required autocomplete="tel" aria-label="–¢–µ–ª–µ—Ñ–æ–Ω">
        <label for="fieldAddr" class="sr-only">–ê–¥—Ä–µ—Å–∞</label>
        <input name="address" id="fieldAddr" class="form-field" placeholder="–ê–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏" style="display:block" autocomplete="street-address" aria-label="–ê–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏">
        <div id="tableRow" style="display:none">
          <label>–°—Ç–æ–ª–∏–∫ ‚Ññ</label>
          <select name="table" id="selectTable" class="form-field"></select>
        </div>
        
        <div style="margin-top:1rem">
          <label style="display:block;margin-bottom:0.5rem;font-weight:600">–°–ø–æ—Å—ñ–± –æ–ø–ª–∞—Ç–∏:</label>
          <select name="paymentMethod" id="paymentMethod" class="form-field" required onchange="togglePayment(this)">
            <option value="cash">–ì–æ—Ç—ñ–≤–∫–∞</option>
            <option value="terminal">–¢–µ—Ä–º—ñ–Ω–∞–ª (–ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ)</option>
            <option value="liqpay">LiqPay (–æ–Ω–ª–∞–π–Ω)</option>
            <option value="fop">–ü–µ—Ä–µ–∫–∞–∑ –Ω–∞ –∫–∞—Ä—Ç–∫—É (–§–û–ü)</option>
          </select>
        </div>
        
        <div id="liqpay-button-container" style="display:none;margin-top:1rem"></div>
        <div id="fop-container" style="display:none;margin-top:1rem"></div>
        
        <button type="submit" id="submitOrderBtn" class="checkout-btn">–û—Ñ–æ—Ä–º–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>
      </form>
    </div>
  </div>

  <script>
    // URL –≤–∞—à–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è) + health-check + fallback
    let API_URL = null;
    let apiAvailable = false;
    const DEFAULT_ABOUT_DESCRIPTION = "Kisso ‚Äì —Ü–µ —Å–º–∞—á–Ω–∞ –ø—ñ—Ü–∞ —Ç–∞ —ñ—Ç–∞–ª—ñ–π—Å—å–∫—ñ —Å—Ç—Ä–∞–≤–∏. –ì–æ—Ç—É—î–º–æ –∑ –ª—é–±–æ–≤'—é!";
    const DEFAULT_RECOMMENDATIONS_MESSAGE = '–î–æ–¥–∞–π—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –≤ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ, —ñ –≤–æ–Ω–∏ –∑\'—è–≤–ª—è—Ç—å—Å—è —Ç—É—Ç.';
    let recommendationsTitle = '–©–æ –∫–∞–∂—É—Ç—å –≥–æ—Å—Ç—ñ';
    let recommendationsFallbackItems = [];
    let popularProducts = [];
    let pendingMenuHighlight = null;
    let menuLoadingPromise = null;
    const likesState = { counts: {}, liked: new Set(), clientToken: null, pending: new Set(), available: true };
    let siteSettings = { google_review_url: '' };
    let seoNeedsRefresh = false;
    const SEO_DEFAULTS = {
      meta_title: document.title,
      meta_description: document.querySelector('meta[name="description"]')?.getAttribute('content') || '',
      meta_keywords: document.querySelector('meta[name="keywords"]')?.getAttribute('content') || '',
      canonical_url: document.querySelector('link[rel="canonical"]')?.getAttribute('href') || window.location.href,
      og_title: document.querySelector('meta[property="og:title"]')?.getAttribute('content') || document.title,
      og_description: document.querySelector('meta[property="og:description"]')?.getAttribute('content') || '',
      og_image: document.querySelector('meta[property="og:image"]')?.getAttribute('content') || '',
      twitter_title: document.querySelector('meta[name="twitter:title"]')?.getAttribute('content') || document.title,
      twitter_description: document.querySelector('meta[name="twitter:description"]')?.getAttribute('content') || ''
    };

    function addCacheBuster(url) {
      if (!url) return url;
      return url + (url.includes('?') ? '&' : '?') + 'v=' + Date.now();
    }

    function escapeHtml(value) {
      if (value === null || value === undefined) return '';
      return String(value)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    }

    function renderTemplate(template, context = {}) {
      if (!template) return '';
      return template.replace(/\{\{\s*(\w+)\s*\}\}/g, (match, key) => {
        const value = context[key];
        if (value === undefined || value === null) return '';
        return String(value);
      });
    }

    function sanitizeSeoText(text) {
      if (!text) return '';
      return String(text)
        .replace(/\.\s*\./g, '.')          // –ø—Ä–∏–±–∏—Ä–∞—î–º–æ –ø–æ–¥–≤—ñ–π–Ω—ñ –∫—Ä–∞–ø–∫–∏
        .replace(/,\s*,/g, ',')            // –ø–æ–¥–≤—ñ–π–Ω—ñ –∫–æ–º–∏
        .replace(/\s+/g, ' ')
        .replace(/^\.\s*/, '')             // –∫—Ä–∞–ø–∫–∞ –Ω–∞ –ø–æ—á–∞—Ç–∫—É
        .replace(/\s*\.$/g, '.')           // –ø—Ä–æ–±—ñ–ª–∏ –ø–µ—Ä–µ–¥ –∫—ñ–Ω—Ü–µ–≤–æ—é –∫—Ä–∞–ø–∫–æ—é
        .trim();
    }

    function deriveCity(address) {
      if (!address) return '';
      const parts = String(address).split(',').map(part => part.trim()).filter(Boolean);
      return parts.length ? parts[0] : '';
    }

    function parseHighlights(raw) {
      if (!raw) return [];
      if (Array.isArray(raw)) return raw.filter(Boolean);
      try {
        const parsed = JSON.parse(raw);
        if (Array.isArray(parsed)) return parsed.filter(Boolean);
      } catch (e) {}
      if (typeof raw === 'string') {
        return raw.split(',').map(item => item.trim()).filter(Boolean);
      }
      return [];
    }

    function toAbsoluteUrl(path) {
      if (!path) return '';
      if (/^https?:\/\//i.test(path)) return path;
      const origin = window.location.origin || 'https://kisso.com.ua';
      if (path.startsWith('/')) return origin + path;
      return origin + '/' + path.replace(/^\.+/, '');
    }

    function buildSeoContext(overrides = {}) {
      const restaurant = siteSettings.restaurant_name || 'Kisso';
      const brand = siteSettings.brand_text || restaurant;
      const phone = siteSettings.restaurant_phone || '+380660209675';
      const address = siteSettings.restaurant_address || '–ö–æ–ª–æ–º–∏—è, –≤—É–ª. –Ü–≤–∞–Ω–∞ –ú–∏–∫–æ–ª–∞–π—á—É–∫–∞';
      const city = deriveCity(address);
      const highlights = parseHighlights(siteSettings.about_highlights);
      const base = {
        restaurant,
        brand,
        phone,
        address,
        city,
        highlight: highlights.length ? highlights[0] : '',
        highlights: highlights.join(', '),
        hours: siteSettings.working_hours || '',
        description: siteSettings.about_description || DEFAULT_ABOUT_DESCRIPTION
      };
      return { ...base, ...overrides };
    }

    function setMetaTag(selector, attribute, value) {
      const el = document.querySelector(selector);
      if (!el) return;
      if (value === null || value === undefined || value === '') {
        if (attribute === 'content') el.removeAttribute('content');
        return;
      }
      el.setAttribute(attribute, value);
    }

    function setStructuredData(data) {
      const el = document.getElementById('seo-ld-json');
      if (!el) return;
      el.textContent = JSON.stringify(data, null, 2);
    }

    function autoComposeMetaKeywords(categories = []) {
      const context = buildSeoContext();
      const baseKeywords = [
        `–ø—ñ—Ü–∞ ${context.city || ''}`.trim(),
        `${context.restaurant}`,
        '–¥–æ—Å—Ç–∞–≤–∫–∞ —ó–∂—ñ',
        '–ø—ñ—Ü–µ—Ä—ñ—è',
        '—Ä–µ—Å—Ç–æ—Ä–∞–Ω –ö–æ–ª–æ–º–∏—è'
      ];
      const categoryKeywords = categories.filter(Boolean).map(name => `${name}`);
      const combined = [...baseKeywords, ...categoryKeywords];
      const unique = Array.from(new Set(combined.map(k => k.toLowerCase())));
      return unique.join(', ');
    }

    function applySeoSettings(settings = {}) {
      siteSettings = { ...siteSettings, ...settings };
      const context = buildSeoContext();
      const autoEnabled = (settings.seo_enable_auto_meta ?? siteSettings.seo_enable_auto_meta ?? 'true') !== 'false';

      const autoTitle = context.city ? `${context.restaurant} ‚Äì –ø—ñ—Ü–∞ —Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∞ –≤ ${context.city}` : `${context.restaurant} ‚Äì –ø—ñ—Ü–∞ —Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∞`;
      const autoDescription = `${context.restaurant}. ${sanitizeSeoText(siteSettings.about_description || DEFAULT_ABOUT_DESCRIPTION)} –¢–µ–ª–µ—Ñ–æ–Ω—É–π—Ç–µ ${context.phone}.`;
      const categories = (Array.isArray(categoriesData) ? categoriesData : []).map(cat => cat.name).filter(Boolean);
      const autoKeywords = autoComposeMetaKeywords(categories);

      const metaTitle = sanitizeSeoText(settings.seo_meta_title) || (autoEnabled ? autoTitle : SEO_DEFAULTS.meta_title);
      const metaDescription = sanitizeSeoText(settings.seo_meta_description) || (autoEnabled ? autoDescription : SEO_DEFAULTS.meta_description);
      const metaKeywords = sanitizeSeoText(settings.seo_meta_keywords) || (autoEnabled ? autoKeywords : SEO_DEFAULTS.meta_keywords);
      const canonicalUrl = sanitizeSeoText(settings.seo_canonical_url) || SEO_DEFAULTS.canonical_url;

      document.title = metaTitle || SEO_DEFAULTS.meta_title;
      setMetaTag('meta[name="description"]', 'content', metaDescription || SEO_DEFAULTS.meta_description);
      setMetaTag('meta[name="keywords"]', 'content', metaKeywords || SEO_DEFAULTS.meta_keywords);
      const canonicalLink = document.getElementById('canonical-link') || document.querySelector('link[rel="canonical"]');
      if (canonicalLink) canonicalLink.setAttribute('href', canonicalUrl);

      const ogTitle = sanitizeSeoText(settings.seo_og_title) || metaTitle || SEO_DEFAULTS.og_title;
      const ogDescription = sanitizeSeoText(settings.seo_og_description) || metaDescription || SEO_DEFAULTS.og_description;
      const ogImage = sanitizeSeoText(settings.seo_og_image) || settings.site_logo || SEO_DEFAULTS.og_image;
      setMetaTag('meta[property="og:title"]', 'content', ogTitle);
      setMetaTag('meta[property="og:description"]', 'content', ogDescription);
      setMetaTag('meta[property="og:image"]', 'content', toAbsoluteUrl(ogImage));
      setMetaTag('meta[property="og:url"]', 'content', canonicalUrl);

      const twitterTitle = sanitizeSeoText(settings.seo_twitter_title) || ogTitle || SEO_DEFAULTS.twitter_title;
      const twitterDescription = sanitizeSeoText(settings.seo_twitter_description) || ogDescription || SEO_DEFAULTS.twitter_description;
      setMetaTag('meta[name="twitter:title"]', 'content', twitterTitle);
      setMetaTag('meta[name="twitter:description"]', 'content', twitterDescription);
      setMetaTag('meta[name="twitter:url"]', 'content', canonicalUrl);
      setMetaTag('meta[name="twitter:image"]', 'content', toAbsoluteUrl(ogImage));

      let socialLinks = siteSettings.social_links;
      if (typeof socialLinks === 'string') {
        try {
          socialLinks = JSON.parse(socialLinks);
        } catch (e) {
          socialLinks = [];
        }
      }
      if (!Array.isArray(socialLinks)) socialLinks = [];

      const structuredData = {
        '@context': 'https://schema.org',
        '@type': 'Restaurant',
        name: context.restaurant,
        image: toAbsoluteUrl(settings.seo_og_image || settings.site_logo || '/att/kisso-site-logo.svg'),
        '@id': canonicalUrl,
        url: canonicalUrl,
        telephone: context.phone,
        priceRange: '‚Ç¥‚Ç¥',
        menu: `${canonicalUrl}#menu`,
        servesCuisine: ['Italian', 'Pizza', 'Ukrainian'],
        acceptsReservations: true,
        address: {
          '@type': 'PostalAddress',
          streetAddress: context.address,
          addressLocality: context.city || '–ö–æ–ª–æ–º–∏—è',
          addressRegion: '–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
          postalCode: '78200',
          addressCountry: 'UA'
        },
        openingHoursSpecification: [
          {
            '@type': 'OpeningHoursSpecification',
            dayOfWeek: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'],
            opens: '10:00',
            closes: '22:00'
          }
        ],
        potentialAction: {
          '@type': 'OrderAction',
          target: {
            '@type': 'EntryPoint',
            urlTemplate: `${canonicalUrl}#menu`,
            actionPlatform: ['http://schema.org/DesktopWebPlatform', 'http://schema.org/MobileWebPlatform']
          },
          deliveryMethod: ['http://purl.org/goodrelations/v1#DeliveryModeOwnFleet']
        }
      };

      structuredData.sameAs = socialLinks.map(link => link && typeof link.url === 'string' ? link.url : null).filter(Boolean);

      setStructuredData(structuredData);
    }

    function renderAboutHighlights(values) {
      const list = document.getElementById('about-highlights-list');
      if (!list) return;
      if (!Array.isArray(values) || values.length === 0) {
        list.innerHTML = '';
        list.style.display = 'none';
        return;
      }
      list.innerHTML = values.map(item => `<li>${escapeHtml(item)}</li>`).join('');
      list.style.display = 'flex';
    }

    function getCategoryNameBySlug(slug) {
      if (!slug || !Array.isArray(categoriesData)) return '';
      const found = categoriesData.find(cat => cat && (cat.slug === slug || String(cat.id) === String(slug)));
      return found ? found.name : '';
    }

    function resolveProductCategory(product) {
      if (!product) return '';
      if (product.category_name) return product.category_name;
      if (product.category) return product.category;
      if (product.category_slug) return getCategoryNameBySlug(product.category_slug) || product.category_slug;
      if (product.category_id) return getCategoryNameBySlug(product.category_id);
      if (product.categoryId) return getCategoryNameBySlug(product.categoryId);
      if (currentCat) return getCategoryNameBySlug(currentCat) || currentCat;
      return '';
    }

    function updateRecommendationsTitle(title) {
      const titleEl = document.getElementById('recommendations-title-site');
      if (titleEl) {
        titleEl.textContent = title || '–©–æ –∫–∞–∂—É—Ç—å –≥–æ—Å—Ç—ñ';
      }
    }

    function setRecommendationsVisibility(isVisible) {
      const section = document.getElementById('recommendations');
      if (!section) return;
      section.style.display = isVisible ? '' : 'none';
    }

    function renderRecommendationFallback(items) {
      const empty = document.getElementById('recommendations-empty');
      const wrapper = document.getElementById('recommendations-wrapper');
      const controls = document.getElementById('recommendations-controls');
      const track = document.getElementById('recommendations-track');
      if (wrapper) wrapper.style.display = 'none';
      if (controls) controls.style.display = 'none';
      if (track) track.innerHTML = '';
      if (!empty) {
        setRecommendationsVisibility(false);
        return;
      }

      if (!Array.isArray(items) || items.length === 0) {
        empty.innerHTML = escapeHtml(DEFAULT_RECOMMENDATIONS_MESSAGE);
        empty.style.display = 'block';
        setRecommendationsVisibility(false);
        return;
      }

      empty.innerHTML = items.map(item => {
        const name = escapeHtml(item.name || '–ì—ñ—Å—Ç—å');
        const text = escapeHtml(item.text || '').replace(/\n/g, '<br>');
        return `
          <article class="testimonial-card" style="background:#fff;border-radius:18px;padding:1.4rem;box-shadow:0 12px 32px rgba(229,75,34,0.08);text-align:left;margin-bottom:1rem">
            <div class="testimonial-name" style="font-weight:700;color:var(--tomato);margin-bottom:0.5rem;font-size:1.05rem">${name}</div>
            <p class="testimonial-text" style="color:rgba(61,43,31,0.75);line-height:1.6;font-size:0.95rem">${text}</p>
          </article>
        `;
      }).join('');
      empty.style.display = 'block';
      setRecommendationsVisibility(true);
    }

    function resolveProductImageUrl(imageUrl) {
      if (!imageUrl) return '';
      let normalized = imageUrl;
      if (normalized.startsWith('/uploads') || normalized.startsWith('/att/')) {
        normalized = `${API_URL.replace('/api', '')}${normalized}`;
      } else if (!normalized.startsWith('http') && !normalized.startsWith('//')) {
        normalized = `${API_URL.replace('/api', '')}/uploads/${normalized}`;
      }
      return normalized;
    }

    function renderRecommendationCarousel(products) {
      const candidateProducts = Array.isArray(products) ? products : [];
      const validProducts = candidateProducts.filter(product => {
        if (!product) return false;
        const match = findProductInMenuData(product);
        return !!match;
      });
      popularProducts = validProducts;
      const wrapper = document.getElementById('recommendations-wrapper');
      const track = document.getElementById('recommendations-track');
      const empty = document.getElementById('recommendations-empty');
      const controls = document.getElementById('recommendations-controls');
      if (!track || !wrapper || !empty) return;

      track.innerHTML = '';

      if (popularProducts.length === 0) {
        renderRecommendationFallback(recommendationsFallbackItems);
        return;
      }

      wrapper.style.display = 'block';
      empty.style.display = 'none';
      if (controls) controls.style.display = popularProducts.length > 1 ? 'flex' : 'none';
      setRecommendationsVisibility(true);

      popularProducts.forEach((product, index) => {
        const card = document.createElement('article');
        card.className = 'recommendation-card';

        let imageMarkup = '<div style="aspect-ratio:4/3;background:#f8f8f8;display:flex;align-items:center;justify-content:center;font-size:48px">üçï</div>';
        const finalUrl = resolveProductImageUrl(product.image_url || product.img || '');
        const productContext = buildSeoContext({
          product: product.name || '–°—Ç—Ä–∞–≤–∞',
          category: resolveProductCategory(product),
          description: product.description || '',
          price: product.base_price ? `${product.base_price} –≥—Ä–Ω` : '',
          sold: typeof product.sold_count === 'number' ? product.sold_count : '',
          index: index + 1
        });
        const productAltTemplate = siteSettings.seo_product_alt_template || '{{product}}';
        const productDescTemplate = siteSettings.seo_product_description_template || '';
        const productFallbackTemplate = siteSettings.seo_product_fallback_description || '';
        const autoAlt = sanitizeSeoText(renderTemplate(productAltTemplate, productContext)) || product.name || '–°—Ç—Ä–∞–≤–∞';
        const autoDescription = sanitizeSeoText(renderTemplate(productDescTemplate, productContext)) || sanitizeSeoText(renderTemplate(productFallbackTemplate, productContext));
        const safeAlt = escapeHtml(autoAlt);
        const hasOriginalDescription = product.description && product.description.trim();
        const autoDescriptionSafe = escapeHtml(autoDescription);
        const renderedDescription = hasOriginalDescription ? product.description : autoDescriptionSafe;
        if (finalUrl) {
          try {
            const webp = finalUrl.replace(/\.(jpg|jpeg|png)$/i, '.webp');
            const hasWebp = webp !== finalUrl;
            const safeFinal = finalUrl.replace(/'/g, '&#39;').replace(/"/g, '&quot;');
            const safeWebp = webp.replace(/'/g, '&#39;').replace(/"/g, '&quot;');
            imageMarkup = hasWebp
              ? `<picture>
                  <source srcset="${safeWebp}" type="image/webp">
                  <img src="${safeFinal}" alt="${safeAlt}" loading="lazy">
                </picture>`
              : `<img src="${safeFinal}" alt="${safeAlt}" loading="lazy">`;
          } catch (e) {
            console.warn('–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π', e);
          }
        }

        const likeHtml = createLikeButtonMarkup(product.id);
        const soldText = typeof product.sold_count === 'number' && product.sold_count > 0
          ? `<span class="sold-chip"><i class="fas fa-fire"></i> ${product.sold_count} –ø—Ä–æ–¥–∞–Ω–æ</span>`
          : '';

        const priceText = product.base_price ? `${product.base_price} –≥—Ä–Ω` : '';

        card.innerHTML = `${imageMarkup}
          <div class="recommendation-body">
            <h3>${escapeHtml(product.name || '')}</h3>
            ${priceText ? `<div class="recommendation-meta"><i class="fas fa-tag"></i> ${priceText}</div>` : ''}
            ${renderedDescription ? `<p style="font-size:0.95rem;color:rgba(61,43,31,0.75);line-height:1.5">${renderedDescription}</p>` : ''}
            <div class="card-engagement">
              ${likeHtml}
              ${soldText}
            </div>
          </div>`;

        if (product.id !== undefined && product.id !== null) {
          card.setAttribute('data-product-id', product.id);
        }
        if (product.name) {
          card.setAttribute('data-product-name', product.name);
        }
        if (product.category_slug || product.category) {
          const categoryKey = product.category_slug || product.category;
          card.setAttribute('data-product-category', categoryKey);
        }
        card.setAttribute('role', 'button');
        card.tabIndex = 0;
        const handleNavigate = () => {
          navigateToMenuProduct(product);
        };
        card.addEventListener('click', handleNavigate);
        card.addEventListener('keydown', event => {
          if (event.key === 'Enter' || event.key === ' ' || event.key === 'Spacebar' || event.key === 'Space') {
            event.preventDefault();
            handleNavigate();
          }
        });

        track.appendChild(card);
      });

      refreshAllLikeButtons();
      updateRecommendationControls();
    }

    function getCategoryTabElement(categoryKey) {
      if (categoryKey === undefined || categoryKey === null) return null;
      const normalized = String(categoryKey);
      const safeKey = normalized.replace(/"/g, '\\"');
      let tab = document.querySelector(`.tab[data-cat="${safeKey}"]`);
      if (tab) return tab;
      if (!Array.isArray(categoriesData)) return null;
      const fallback = categoriesData.find(cat => {
        if (!cat) return false;
        return String(cat.slug) === normalized || String(cat.id) === normalized || cat.name === normalized;
      });
      if (!fallback) return null;
      const fallbackKey = String(fallback.slug || fallback.id || fallback.name).replace(/"/g, '\\"');
      return document.querySelector(`.tab[data-cat="${fallbackKey}"]`);
    }

    function findProductInMenuData(product) {
      if (!product) return null;
      const targetId = product.id ?? product.product_id ?? null;
      const targetSlug = product.slug || product.alias || null;
      const targetName = product.name || '';
      for (const [categoryKey, items] of Object.entries(menuData || {})) {
        if (!Array.isArray(items)) continue;
        const match = items.find(item => {
          if (!item) return false;
          if (targetId !== null && targetId !== undefined && (String(item.id) === String(targetId) || String(item.product_id) === String(targetId))) return true;
          if (targetSlug && (item.slug === targetSlug || item.alias === targetSlug)) return true;
          if (targetName && item.name === targetName) return true;
          return false;
        });
        if (match) {
          return { category: categoryKey, product: match };
        }
      }
      return null;
    }

    function focusMenuCard(productId, productName, attempt = 0) {
      const maxAttempts = 6;
      let card = null;
      if (productId !== undefined && productId !== null) {
        const safeId = String(productId).replace(/"/g, '\\"');
        card = document.querySelector(`.card[data-product-id="${safeId}"]`);
      }
      if (!card && productName) {
        const targetName = productName.trim().toLowerCase();
        card = Array.from(document.querySelectorAll('.card')).find(node => {
          const title = node.querySelector('.card-title');
          return title && title.textContent.trim().toLowerCase() === targetName;
        });
      }
      if (card) {
        if (!card.hasAttribute('tabindex')) {
          card.setAttribute('tabindex', '-1');
        }
        try {
          card.focus({ preventScroll: true });
        } catch (e) {
          try { card.focus(); } catch (err) {}
        }
        card.classList.add('highlight-target');
        card.scrollIntoView({ behavior: 'smooth', block: 'center' });
        setTimeout(() => card.classList.remove('highlight-target'), 2200);
        return true;
      }
      if (attempt < maxAttempts) {
        setTimeout(() => focusMenuCard(productId, productName, attempt + 1), 140);
        return false;
      }
      console.warn('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–Ω–∞–π—Ç–∏ –∫–∞—Ä—Ç–∫—É —Ç–æ–≤–∞—Ä—É –¥–ª—è –ø—ñ–¥—Å–≤—ñ—Ç–∫–∏', productName || productId);
      return false;
    }

    async function navigateToMenuProduct(product) {
      try {
        const menuSection = document.getElementById('menu');
        if (menuSection) {
          menuSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        if (!product) return;

        if (!menuData || Object.keys(menuData).length === 0) {
          await loadMenu();
        }

        let location = findProductInMenuData(product);
        if (!location) {
          await loadMenu(true);
          location = findProductInMenuData(product);
        }
        if (!location) {
          console.warn('–¢–æ–≤–∞—Ä –∑ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ —É –º–µ–Ω—é', product);
          return;
        }

        const { category, product: matchedProduct } = location;
        pendingMenuHighlight = {
          id: matchedProduct.id ?? matchedProduct.product_id ?? null,
          name: matchedProduct.name || product.name || ''
        };

        if (currentCat !== category) {
          currentCat = category;
        }

        const tabEl = getCategoryTabElement(category);
        if (tabEl) {
          const currentActive = document.querySelector('.tab.active');
          if (currentActive) {
            currentActive.classList.remove('active');
          }
          tabEl.classList.add('active');
        }

        searchStr = '';
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
          searchInput.value = '';
          searchInput.style.boxShadow = '';
        }

        const nav = document.getElementById('main-nav');
        const burger = document.querySelector('.burger');
        if (nav && nav.classList.contains('open')) {
          nav.classList.remove('open');
          if (burger) {
            burger.classList.remove('open');
          }
        }

        render();
      } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥—É –¥–æ —Ç–æ–≤–∞—Ä—É –∑ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π', error);
      }
    }

    function scrollRecommendations(direction = 1) {
      const track = document.getElementById('recommendations-track');
      if (!track) return;
      const card = track.querySelector('.recommendation-card');
      const step = card ? card.offsetWidth + 20 : track.clientWidth;
      track.scrollBy({ left: direction * step, behavior: 'smooth' });
      setTimeout(updateRecommendationControls, 350);
    }

    function updateRecommendationControls() {
      const track = document.getElementById('recommendations-track');
      const prev = document.getElementById('recommendations-prev');
      const next = document.getElementById('recommendations-next');
      if (!track || !prev || !next) return;
      const maxScroll = Math.max(0, track.scrollWidth - track.clientWidth - 5);
      prev.disabled = track.scrollLeft <= 5;
      next.disabled = track.scrollLeft >= maxScroll;
    }

    function createLikeButtonMarkup(productId) {
      const count = likesState.counts[productId] || 0;
      const liked = likesState.liked.has(productId);
      const iconClass = liked ? 'fa-solid' : 'fa-regular';
      const disabledAttr = likesState.available ? '' : 'disabled aria-disabled="true"';
      return `
        <button type="button" class="like-btn ${liked ? 'liked' : ''}" data-product-like="${productId}" aria-pressed="${liked}" ${disabledAttr} onclick="handleLikeClick(event, ${productId})">
          <i class="${iconClass} fa-heart"></i>
          <span class="like-count" data-like-count>${count}</span>
        </button>
      `;
    }

    function refreshAllLikeButtons() {
      document.querySelectorAll('[data-product-like]').forEach(btn => {
        const id = parseInt(btn.getAttribute('data-product-like'), 10);
        if (!id) return;
        const liked = likesState.liked.has(id);
        const count = likesState.counts[id] || 0;
        btn.classList.toggle('liked', liked);
        btn.setAttribute('aria-pressed', liked ? 'true' : 'false');
        btn.disabled = !likesState.available;
        btn.setAttribute('aria-disabled', likesState.available ? 'false' : 'true');
        const icon = btn.querySelector('i');
        if (icon) {
          icon.className = `${liked ? 'fa-solid' : 'fa-regular'} fa-heart`;
        }
        const counter = btn.querySelector('[data-like-count]');
        if (counter) counter.textContent = count;
      });
    }

    function ensureClientToken() {
      if (likesState.clientToken) return likesState.clientToken;
      try {
        let stored = localStorage.getItem('kisso-client-token');
        if (!stored) {
          stored = `kisso-${Math.random().toString(36).slice(2)}-${Date.now().toString(36)}`;
          localStorage.setItem('kisso-client-token', stored);
        }
        likesState.clientToken = stored;
      } catch (e) {
        // –Ø–∫—â–æ localStorage –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π, –≥–µ–Ω–µ—Ä—É—î–º–æ —Ç–∏–º—á–∞—Å–æ–≤–∏–π —Ç–æ–∫–µ–Ω
        likesState.clientToken = `kisso-${Math.random().toString(36).slice(2)}-${Date.now().toString(36)}`;
      }
      return likesState.clientToken;
    }

    async function loadLikes() {
      try {
        const token = ensureClientToken();
        const res = await fetch(`${API_URL}/product-likes?clientToken=${encodeURIComponent(token)}`);
        if (res.status === 404) {
          likesState.counts = {};
          likesState.liked = new Set();
          likesState.available = false;
          refreshAllLikeButtons();
          return;
        }
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        likesState.counts = data.counts || {};
        likesState.liked = new Set(Array.isArray(data.liked) ? data.liked.map(id => parseInt(id, 10)).filter(Boolean) : []);
        likesState.available = true;
        refreshAllLikeButtons();
      } catch (e) {
        console.warn('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ª–∞–π–∫–∏', e);
      }
    }

    async function handleLikeClick(event, productId) {
      event.stopPropagation();
      event.preventDefault();
      if (!productId) return;
      if (!likesState.available) {
        showTempMessage(event.currentTarget?.parentElement || document.body, '–õ–∞–π–∫–∏ —Ç–∏–º—á–∞—Å–æ–≤–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ');
        return;
      }
      ensureClientToken();
      if (likesState.pending.has(productId)) return;
      const button = event.currentTarget;
      const likedBefore = likesState.liked.has(productId);
      const method = likedBefore ? 'DELETE' : 'POST';
      likesState.pending.add(productId);

      try {
        const res = await fetch(`${API_URL}/product-likes`, {
          method,
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ productId, clientToken: likesState.clientToken })
        });

        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const payload = await res.json();

        if (likedBefore) {
          likesState.liked.delete(productId);
        } else {
          likesState.liked.add(productId);
        }

        if (typeof payload.totalLikes === 'number') {
          likesState.counts[productId] = payload.totalLikes;
        } else {
          const current = likesState.counts[productId] || 0;
          likesState.counts[productId] = likedBefore ? Math.max(0, current - 1) : current + 1;
        }

        refreshAllLikeButtons();
      } catch (err) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–º—ñ–Ω—ñ –ª–∞–π–∫–∞', err);
        if (button) {
          showTempMessage(button.parentElement || document.body, '–ü–æ–º–∏–ª–∫–∞. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.');
        }
      } finally {
        likesState.pending.delete(productId);
      }
    }

    function renderGallerySection(items) {
      const grid = document.getElementById('gallery-grid');
      if (!grid) return;
      if (!Array.isArray(items) || items.length === 0) {
        grid.innerHTML = '<div class="gallery-empty">–°–∫–æ—Ä–æ —Ç—É—Ç –∑\'—è–≤–ª—è—Ç—å—Å—è —Ñ–æ—Ç–æ –∑ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—É.</div>';
        return;
      }
      const sorted = items.slice().sort((a, b) => {
        const orderA = Number.isFinite(Number(a.order_index)) ? Number(a.order_index) : 0;
        const orderB = Number.isFinite(Number(b.order_index)) ? Number(b.order_index) : 0;
        if (orderA !== orderB) return orderA - orderB;
        return new Date(a.created_at || 0) - new Date(b.created_at || 0);
      });
      grid.innerHTML = sorted.map((item, index) => {
        const baseCaption = item.title || item.alt_text || '';
        const context = buildSeoContext({
          title: baseCaption || `–§–æ—Ç–æ ${siteSettings.restaurant_name || '—Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞'}`,
          description: baseCaption || '',
          index: index + 1
        });
        const galleryAltTemplate = siteSettings.seo_gallery_alt_template || '–§–æ—Ç–æ {{restaurant}} ‚Äì {{title}}';
        const galleryDescriptionTemplate = siteSettings.seo_gallery_description_template || '';
        const autoAlt = sanitizeSeoText(renderTemplate(galleryAltTemplate, context));
        const autoDescription = sanitizeSeoText(renderTemplate(galleryDescriptionTemplate, context));
        const altText = item.alt_text && item.alt_text.trim() ? item.alt_text : (autoAlt || '–§–æ—Ç–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—É');
        const finalCaption = item.title && item.title.trim() ? item.title : autoDescription;
        const img = `<img src="${addCacheBuster(item.file_path)}" alt="${escapeHtml(altText)}">`;
        const captionHtml = finalCaption ? `<figcaption class="gallery-caption">${escapeHtml(finalCaption)}</figcaption>` : '';
        return `<figure class="gallery-card">${img}${captionHtml}</figure>`;
      }).join('');
    }

    async function loadGallerySection() {
      try {
        const res = await fetch(`${API_URL}/gallery`);
        if (res.status === 404) {
          renderGallerySection([]);
          return;
        }
        if (res.ok) {
          const items = await res.json();
          renderGallerySection(items);
        }
      } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≥–∞–ª–µ—Ä–µ—ó:', error);
      }
    }

    function resumeOrderTrackingIfNeeded() {
      if (shouldResumeOrderTracking && API_URL && trackedOrder && trackedOrder.order_number) {
        shouldResumeOrderTracking = false;
        startOrderTracking();
      }
    }

    async function detectApiUrl(timeout = 1500) {
      const candidates = [];
      try { if (window.location.origin && window.location.origin.startsWith('http')) candidates.push(window.location.origin + '/api'); } catch (e) {}
      candidates.push('http://localhost:3000/api');
      candidates.push('http://127.0.0.1:3000/api');

      for (const cand of candidates) {
        try {
          // –ù–µ–≤–µ–ª–∏–∫–∏–π —Ç–∞–π–º–∞—É—Ç –∑–∞–ø–∏—Ç—É
          const controller = new AbortController();
          const id = setTimeout(() => controller.abort(), timeout);
          const res = await fetch(cand + '/health', { signal: controller.signal, cache: 'no-store' });
          clearTimeout(id);
          if (res && res.ok) {
            API_URL = cand;
            apiAvailable = true;
            console.info('API –¥–æ—Å—Ç—É–ø–Ω–∏–π –∑–∞:', API_URL);
            return true;
          }
        } catch (e) {
          // ignore and try next
        }
      }
      API_URL = candidates[0] || 'http://localhost:3000/api'; // default guess
      apiAvailable = false;
      console.warn('API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ –±–µ–∫–µ–Ω–¥ –∑–∞–ø—É—â–µ–Ω–æ –Ω–∞ localhost:3000');
      return false;
    }

    function showApiError(container, msg) {
      container.innerHTML = `
        <div style="text-align:center;grid-column:1/-1;padding:2rem;color:var(--tomato)">
          <p style="margin:.5rem 0;font-weight:700">–ù–µ –≤–¥–∞—î—Ç—å—Å—è –∑'—î–¥–Ω–∞—Ç–∏—Å—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º</p>
          <p style="margin:.25rem 0;color:#7a5b4a">${msg || '–°–µ—Ä–≤—ñ—Å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω–æ —ñ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –ü–æ–≤—Ç–æ—Ä–∏—Ç–∏.'}</p>
          <div style="margin-top:1rem">
            <button class="btn" id="retryApiBtn">–ü–æ–≤—Ç–æ—Ä–∏—Ç–∏</button>
          </div>
        </div>
      `;
      const btn = document.getElementById('retryApiBtn');
      if (btn) btn.addEventListener('click', async () => {
        btn.disabled = true; btn.textContent = '–ü–µ—Ä–µ–≤—ñ—Ä—è—é...';
        const ok = await detectApiUrl(2000);
        if (ok) {
          // reload data
          loadSettings();
          loadMenu();
          resumeOrderTrackingIfNeeded();
        } else {
          btn.disabled = false; btn.textContent = '–ü–æ–≤—Ç–æ—Ä–∏—Ç–∏';
        }
      });
    }

    // –ì–ª–æ–±–∞–ª—å–Ω–∏–π –æ–±—Ä–æ–±–Ω–∏–∫ –Ω–µ–æ–±—Ä–æ–±–ª–µ–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫ ‚Äî –ø–æ–∫–∞–∑—É—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑–∞–º—ñ—Å—Ç—å —Å–∏—Ä–æ–≥–æ —Å—Ç–∞–∫—É
    (function registerGlobalErrorHandlers(){
      function showBanner(msg){
        let b = document.getElementById('globalErrorBanner');
        if (!b) {
          b = document.createElement('div');
          b.id = 'globalErrorBanner';
          b.style.cssText = 'position:fixed;top:1rem;right:1rem;z-index:9999;background:rgba(229,75,34,0.95);color:#fff;padding:0.7rem 1rem;border-radius:10px;box-shadow:0 8px 24px rgba(0,0,0,0.2);font-weight:700';
          document.body.appendChild(b);
        }
        b.textContent = msg;
        setTimeout(()=>{ try{ b.remove(); }catch(e){} }, 8000);
      }

      window.addEventListener('error', function(ev){
        console.error('Global error caught:', ev.error || ev.message || ev);
        showBanner('–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å.');
      });

      window.addEventListener('unhandledrejection', function(ev){
        console.error('Unhandled rejection:', ev.reason);
        showBanner('–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å.');
      });
    })();
    let menuData = {};
    let categoriesData = [];
    let cart = [];
    let currentCat = '';
    let searchStr = '';
    const MAX_TABLES = 15;
    let liqpayReady = false;
    let fopReady = false;
    let fopPollStop = null;

    // Flag set to true after the user interacts with the page (needed for vibrate permission)
    let userInteracted = false;
    document.addEventListener('click', function onFirstInteraction() {
      userInteracted = true;
      document.removeEventListener('click', onFirstInteraction, true);
    }, { once: true, capture: true });
    
    // –°—Ç–∞—Ç—É—Å –ø—ñ—Ü–µ—Ä—ñ—ó
    let pizzeriaStatus = { isOpen: true, closedMessage: '' };
    
    // –§—É–Ω–∫—Ü—ñ—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å—É –ø—ñ—Ü–µ—Ä—ñ—ó
    async function checkPizzeriaStatus() {
      try {
        const res = await fetch(`${API_URL}/settings/status`);
        if (res.ok) {
          pizzeriaStatus = await res.json();
          updateClosedBanner();
        }
      } catch (e) {
        console.error('Error checking pizzeria status:', e);
      }
    }
    
    // –ü–æ–∫–∞–∑/–ø—Ä–∏—Ö–æ–≤–∞–Ω–Ω—è –±–∞–Ω–µ—Ä–∞ "–ó–∞–∫—Ä–∏—Ç–æ"
    function updateClosedBanner() {
      let overlay = document.getElementById('closed-overlay');

      if (!pizzeriaStatus.isOpen) {
        if (!overlay) {
          overlay = document.createElement('div');
          overlay.id = 'closed-overlay';
          overlay.style.cssText = `
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(21, 14, 14, 0.92);
            color: #fff;
            z-index: 20000;
            padding: 2rem;
            text-align: center;
            font-weight: 700;
            font-size: 1.35rem;
            line-height: 1.5;
            backdrop-filter: blur(6px);
            transition: opacity 0.3s ease;
          `;
          overlay.innerHTML = `
            <div style="max-width: 460px;display:flex;flex-direction:column;align-items:center;gap:1rem;">
              <i class="fas fa-store-alt-slash" style="font-size:3rem;"></i>
              <span id="closed-overlay-message"></span>
            </div>
          `;
          document.body.appendChild(overlay);
        }

        const messageEl = overlay.querySelector('#closed-overlay-message');
        if (messageEl) {
          messageEl.textContent = pizzeriaStatus.closedMessage || '–ü—ñ—Ü–µ—Ä—ñ—è –∑–∞—Ä–∞–∑ –∑–∞–∫—Ä–∏—Ç–∞. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.';
        }

        overlay.style.display = 'flex';
        overlay.style.opacity = '1';
        overlay.style.pointerEvents = 'all';
        document.body.style.overflow = 'hidden';
        document.body.style.touchAction = 'none';
      } else if (overlay) {
        overlay.style.opacity = '0';
        overlay.style.pointerEvents = 'none';
        overlay.style.display = 'none';
        document.body.style.overflow = '';
        document.body.style.touchAction = '';
      }
    }
    
    // –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
    let trackedOrder = JSON.parse(localStorage.getItem('kisso-tracked-order') || 'null');
    let orderCheckInterval = null;
    let shouldResumeOrderTracking = false;
    
    // –ü—Ä–æ–º–æ–∫–æ–¥
    let appliedPromocode = null;
    let discountAmount = 0;
    
    // –§—É–Ω–∫—Ü—ñ—è –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è —Å–µ–∫—Ü—ñ—ó –ø—Ä–æ–º–æ–∫–æ–¥—É
    function togglePromoSection() {
      const content = document.getElementById('promoContent');
      const icon = document.getElementById('promoToggleIcon');
      const isOpen = content.style.display !== 'none';
      
      content.style.display = isOpen ? 'none' : 'block';
      icon.style.transform = isOpen ? 'rotate(0deg)' : 'rotate(180deg)';
    }
    
    // –§—É–Ω–∫—Ü—ñ—è –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –ø—Ä–æ–º–æ–∫–æ–¥—É
    async function applyPromocode() {
      const input = document.getElementById('promocodeInput');
      const resultDiv = document.getElementById('promocodeResult');
      const code = input.value.trim().toUpperCase();
      
      if (!code) {
        resultDiv.innerHTML = '<span style="color:#c00">–í–≤–µ–¥—ñ—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥</span>';
        return;
      }
      
      const orderAmount = cart.reduce((s, i) => s + i.price * i.qty, 0);
      
      try {
        const response = await fetch(`${API_URL}/promocodes/validate`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ code, order_amount: orderAmount })
        });
        
        const data = await response.json();
        
        if (data.valid) {
          appliedPromocode = data;
          discountAmount = data.discount_amount;
          
          const discountText = data.discount_type === 'percent' 
            ? `${data.discount_value}%` 
            : `${data.discount_value} ‚Ç¥`;
          
          resultDiv.innerHTML = `<span style="color:#2e7d32">‚úì –ü—Ä–æ–º–æ–∫–æ–¥ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ: -${discountText}</span>`;
          input.disabled = true;
          input.style.background = '#e8f5e9';
          
          updateCartTotals();
        } else {
          appliedPromocode = null;
          discountAmount = 0;
          resultDiv.innerHTML = `<span style="color:#c00">‚úó ${data.error}</span>`;
          updateCartTotals();
        }
      } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—Ä–æ–º–æ–∫–æ–¥—É:', error);
        resultDiv.innerHTML = '<span style="color:#c00">–ü–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞</span>';
      }
    }
    
    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—ñ–¥—Å—É–º–∫—ñ–≤ –∫–æ—à–∏–∫–∞
    function updateCartTotals() {
      const subtotal = cart.reduce((s, i) => s + i.price * i.qty, 0);
      document.getElementById('cartTotal').textContent = subtotal + ' –≥—Ä–Ω';
      
      const discountRow = document.getElementById('discountRow');
      const finalRow = document.getElementById('finalTotalRow');
      
      if (appliedPromocode && discountAmount > 0) {
        discountRow.style.display = 'flex';
        document.getElementById('discountAmount').textContent = `-${discountAmount} –≥—Ä–Ω`;
        
        finalRow.style.display = 'flex';
        document.getElementById('finalTotal').textContent = (subtotal - discountAmount) + ' –≥—Ä–Ω';
      } else {
        discountRow.style.display = 'none';
        finalRow.style.display = 'none';
      }
    }
    
    // –°–∫–∏–¥–∞–Ω–Ω—è –ø—Ä–æ–º–æ–∫–æ–¥—É
    function resetPromocode() {
      appliedPromocode = null;
      discountAmount = 0;
      const input = document.getElementById('promocodeInput');
      if (input) {
        input.value = '';
        input.disabled = false;
        input.style.background = '';
      }
      const resultDiv = document.getElementById('promocodeResult');
      if (resultDiv) resultDiv.innerHTML = '';
      updateCartTotals();
    }

    // LiqPay / FOP —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª
    function togglePayment(select) {
      const liqpayContainer = document.getElementById('liqpay-button-container');
      const fopContainer = document.getElementById('fop-container');
      const submitBtn = document.getElementById('submitOrderBtn');
      submitBtn.disabled = false;

      if (select.value === 'liqpay') {
        liqpayContainer.style.display = 'block';
        fopContainer.style.display = 'none';
        submitBtn.textContent = '–û–ø–ª–∞—Ç–∏—Ç–∏ —á–µ—Ä–µ–∑ LiqPay';
        submitBtn.style.display = 'block';
        liqpayReady = true;
        fopReady = false;
      } else if (select.value === 'fop') {
        liqpayContainer.style.display = 'none';
        fopContainer.style.display = 'block';
        submitBtn.textContent = '–û—Ñ–æ—Ä–º–∏—Ç–∏ —Ä–µ–∫–≤—ñ–∑–∏—Ç–∏';
        submitBtn.style.display = 'block';
        liqpayReady = false;
        fopReady = true;
      } else {
        liqpayContainer.style.display = 'none';
        fopContainer.style.display = 'none';
        submitBtn.textContent = '–û—Ñ–æ—Ä–º–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è';
        submitBtn.style.display = 'block';
        liqpayReady = false;
        fopReady = false;
      }
    }

    // LiqPay –æ–ø–ª–∞—Ç–∞ - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É –æ–ø–ª–∞—Ç–∏
    async function processLiqPayPayment(orderId, totalAmount) {
      const liqpayContainer = document.getElementById('liqpay-button-container');
      liqpayContainer.innerHTML = '<p style="text-align:center;padding:1rem;color:var(--olive)"><i class="fas fa-spinner fa-spin"></i> –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–æ –æ–ø–ª–∞—Ç–∏ LiqPay...</p>';
      
      try {
        // –ó–∞–ø–∏—Ç –¥–æ —Å–µ—Ä–≤–µ—Ä—É –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö LiqPay
        const response = await fetch(`${API_URL}/liqpay/checkout`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            order_id: orderId,
            amount: totalAmount,
            description: `–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è #${orderId} - Kisso Pizza`
          })
        });
        
        if (response.ok) {
          const liqpayData = await response.json();
          // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î–º–æ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É –æ–ø–ª–∞—Ç–∏ LiqPay
          if (liqpayData.checkout_url) {
            window.location.href = liqpayData.checkout_url;
          } else {
            // –Ø–∫—â–æ —Å–µ—Ä–≤–µ—Ä –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π, –ø–æ–∫–∞–∑—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
            liqpayContainer.innerHTML = `
              <div style="text-align:center;padding:1rem;background:#fff8e1;border-radius:8px;border:1px solid #f9c74f">
                <p style="margin-bottom:0.5rem;font-weight:600">‚úÖ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–≤–æ—Ä–µ–Ω–æ!</p>
                <p style="font-size:0.9rem;color:#666">–ù–æ–º–µ—Ä: ${orderId}</p>
                <p style="font-size:0.9rem;color:#666;margin-top:0.5rem">LiqPay –æ–ø–ª–∞—Ç–∞ –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∞ –ø—ñ—Å–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è.</p>
                <p style="font-size:0.9rem;color:#666">–í–∏ –º–æ–∂–µ—Ç–µ –æ–ø–ª–∞—Ç–∏—Ç–∏ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ.</p>
              </div>
            `;
          }
        } else {
          throw new Error('–ü–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
        }
      } catch (error) {
        console.error('LiqPay error:', error);
        liqpayContainer.innerHTML = `
          <div style="text-align:center;padding:1rem;background:#fff8e1;border-radius:8px;border:1px solid #f9c74f">
            <p style="margin-bottom:0.5rem;font-weight:600">‚úÖ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–≤–æ—Ä–µ–Ω–æ!</p>
            <p style="font-size:0.9rem;color:#666">–û–Ω–ª–∞–π–Ω –æ–ø–ª–∞—Ç–∞ —Ç–∏–º—á–∞—Å–æ–≤–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.</p>
            <p style="font-size:0.9rem;color:#666">–í–∏ –º–æ–∂–µ—Ç–µ –æ–ø–ª–∞—Ç–∏—Ç–∏ –≥–æ—Ç—ñ–≤–∫–æ—é –∞–±–æ —Ç–µ—Ä–º—ñ–Ω–∞–ª–æ–º.</p>
          </div>
        `;
      }
    }

    // FOP: —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó —Ç–∞ polling
    async function processFopPayment(orderId, totalAmount) {
      const fopContainer = document.getElementById('fop-container');
      fopContainer.innerHTML = '<p style="text-align:center;padding:1rem;color:var(--olive)"><i class="fas fa-spinner fa-spin"></i> –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –æ–ø–ª–∞—Ç–∏...</p>';

      try {
        const response = await fetch(`${API_URL}/fop/checkout`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ order_id: orderId, amount: totalAmount, description: `–û–ø–ª–∞—Ç–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è #${orderId}` })
        });

        if (!response.ok) throw new Error('HTTP ' + response.status);
        const data = await response.json();

        if (!data.payment_instructions) {
          fopContainer.innerHTML = `
            <div style="text-align:center;padding:1rem;background:#fff8e1;border-radius:8px;border:1px solid #f9c74f">
              <p style="margin-bottom:0.5rem;font-weight:600">‚ö†Ô∏è –†–µ–∫–≤—ñ–∑–∏—Ç–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ</p>
              <p style="font-size:0.9rem;color:#666">–†–µ–∫–≤—ñ–∑–∏—Ç–∏ –§–û–ü –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ. –û–ø–ª–∞—Ç—ñ—Ç—å –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ.</p>
            </div>`;
          return;
        }

        const inst = data.payment_instructions;
        fopContainer.innerHTML = `
          <div style="background:#fff;border-radius:8px;padding:1rem;border:1px solid #eee;position:relative">
            <p style="margin:0 0 .5rem;font-weight:700">–†–µ–∫–≤—ñ–∑–∏—Ç–∏ –¥–ª—è –æ–ø–ª–∞—Ç–∏</p>
            <div style="font-size:0.95rem;color:#333;line-height:1.4">
              <div><b>–û–¥–µ—Ä–∂—É–≤–∞—á:</b> ${inst.owner}</div>
              <div><b>–†–∞—Ö—É–Ω–æ–∫:</b> <code id="fop-account">${inst.account}</code> <button id="copyFopAccount" style="margin-left:8px">–ö–æ–ø—ñ—é–≤–∞—Ç–∏</button></div>
              <div><b>–ë–∞–Ω–∫:</b> ${inst.bank}</div>
              <div><b>–Ñ–î–†–ü–û–£:</b> ${inst.edrpou}</div>
              <div><b>–°—É–º–∞:</b> ${inst.amount} ${inst.currency}</div>
              <div><b>–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:</b> ${inst.description}</div>
              <div style="margin-top:.5rem"><b>–†–µ—Ñ–µ—Ä–µ–Ω—Å:</b> <code id="fop-ref">${inst.payment_reference}</code></div>
            </div>
            <div style="margin-top:0.75rem;display:flex;gap:.5rem">
              <button id="iPaidBtn" class="checkout-btn" style="flex:1">–Ø –æ–ø–ª–∞—Ç–∏–≤</button>
              <button id="copyAllBtn" style="flex:1">–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –≤—Å—ñ —Ä–µ–∫–≤—ñ–∑–∏—Ç–∏</button>
            </div>
            <div id="fop-status" style="margin-top:.75rem;font-size:0.95rem;color:#666"></div>
          </div>
        `;

        document.getElementById('copyFopAccount').addEventListener('click', () => {
          navigator.clipboard.writeText(inst.account).then(()=> showTempMessage(fopContainer,'–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!'));
        });

        document.getElementById('copyAllBtn').addEventListener('click', ()=>{
          const all = `–û–¥–µ—Ä–∂—É–≤–∞—á: ${inst.owner}\n–†–∞—Ö—É–Ω–æ–∫: ${inst.account}\n–ë–∞–Ω–∫: ${inst.bank}\n–Ñ–î–†–ü–û–£: ${inst.edrpou}\n–°—É–º–∞: ${inst.amount} ${inst.currency}\n–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è: ${inst.description}\n–†–µ—Ñ–µ—Ä–µ–Ω—Å: ${inst.payment_reference}`;
          navigator.clipboard.writeText(all).then(()=> showTempMessage(fopContainer,'–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!'));
        });

        document.getElementById('iPaidBtn').addEventListener('click', function onceIPaid(){
          const btn = document.getElementById('iPaidBtn');
          if (btn) { btn.disabled = true; btn.textContent = '–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞...'; btn.removeEventListener('click', onceIPaid); }
          const statusEl = document.getElementById('fop-status');
          statusEl.textContent = '–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É...';
          if (fopPollStop) fopPollStop();
          fopPollStop = pollFopStatus(orderId, (s)=>{
            if (s.is_paid) {
              const el = document.getElementById('fop-status');
              if (el) el.innerHTML = '<span style="color:var(--olive);font-weight:700">–û–ø–ª–∞—á–µ–Ω–æ ‚úÖ</span>';
              if (fopPollStop) { fopPollStop(); fopPollStop = null; }
              const submitBtn = document.getElementById('submitOrderBtn');
              if (submitBtn) {
                submitBtn.textContent = '‚úÖ –û–ø–ª–∞—Ç—É –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ';
                submitBtn.disabled = true;
              }

              trackedOrder = {
                order_number: orderId,
                status: 'pending',
                last_checked: Date.now()
              };
              localStorage.setItem('kisso-tracked-order', JSON.stringify(trackedOrder));
              startOrderTracking();

              setTimeout(() => {
                alert('–û–ø–ª–∞—Ç—É –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ ‚úÖ\n–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø–µ—Ä–µ–¥–∞–Ω–æ –≤ —Ä–æ–±–æ—Ç—É. –ù–æ–º–µ—Ä: ' + orderId);
                cart = [];
                localStorage.removeItem('kisso-cart');
                document.getElementById('count').textContent = 0;
                document.getElementById('orderForm').reset();
                resetPromocode();
                updateCart();
                toggleCart();
                togglePayment(document.getElementById('paymentMethod'));
                const submitBtn = document.getElementById('submitOrderBtn');
                if (submitBtn) {
                  submitBtn.textContent = '–û—Ñ–æ—Ä–º–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è';
                  submitBtn.disabled = false;
                }
              }, 500);
            } else {
              const el = document.getElementById('fop-status');
              if (el) el.textContent = '–û—á—ñ–∫—É–≤–∞–Ω–Ω—è –æ–ø–ª–∞—Ç–∏...';
            }
          }, 5000);
        });

      } catch (err) {
        console.error('FOP error:', err);
        fopContainer.innerHTML = `<div style="text-align:center;padding:1rem;background:#fff8e1;border-radius:8px;border:1px solid #f9c74f"><p style="font-weight:600">‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ä–µ–∫–≤—ñ–∑–∏—Ç—ñ–≤</p><p style="font-size:0.9rem;color:#666">–Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –æ–ø–ª–∞—Ç–∏ —Ç–∏–º—á–∞—Å–æ–≤–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.</p></div>`;
      }
    }

    function pollFopStatus(orderId, onUpdate, interval = 5000) {
      let stopped = false;
      const timer = setInterval(async () => {
        try {
          const res = await fetch(`${API_URL}/fop/status/${encodeURIComponent(orderId)}`);
          if (!res.ok) throw new Error('HTTP ' + res.status);
          const json = await res.json();
          onUpdate(json);
          if (json.is_paid) {
            clearInterval(timer);
            stopped = true;
          }
        } catch (e) {
          console.error('pollFopStatus error', e);
        }
      }, interval);
      return () => { if (!stopped) { clearInterval(timer); stopped = true; } };
    }

    function showTempMessage(container, msg, timeout = 1200) {
      const m = document.createElement('div');
      m.style.cssText = 'position:absolute;top:8px;right:8px;background:#333;color:#fff;padding:6px;border-radius:6px;font-size:12px';
      m.textContent = msg;
      container.appendChild(m);
      setTimeout(() => m.remove(), timeout);
    }

    
    // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑ —Å–µ—Ä–≤–µ—Ä–∞
    async function loadSettings() {
      try {
        const response = await fetch(`${API_URL}/settings`);
        if (response.ok) {
          const settings = await response.json();
          siteSettings = { ...siteSettings, ...settings };
          applySeoSettings(settings);
          
          // –û–Ω–æ–≤–ª—é—î–º–æ –Ω–∞–∑–≤—É —Ä–µ—Å—Ç–æ—Ä–∞–Ω—É
          if (settings.restaurant_name) {
            const nameEl = document.getElementById('restaurant-name-header');
            if (nameEl) nameEl.textContent = settings.restaurant_name;
            const nameFooter = document.getElementById('restaurant-name-footer');
            if (nameFooter) nameFooter.textContent = settings.restaurant_name;
          }

          if (settings.brand_text) {
            const brand = document.getElementById('brand-text');
            if (brand) brand.textContent = settings.brand_text;
          }
          
          // –û–Ω–æ–≤–ª—é—î–º–æ —Ç–µ–ª–µ—Ñ–æ–Ω
          if (settings.restaurant_phone) {
            const phone = settings.restaurant_phone;
            const normalizedPhone = phone.replace(/[^0-9+]/g, '');
            const phoneHeader = document.getElementById('restaurant-phone-header');
            if (phoneHeader) phoneHeader.textContent = `–î–æ—Å—Ç–∞–≤–∫–∞ —Ç–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–æ–ª–∏–∫—ñ–≤: ${phone}`;
            const phoneContact = document.getElementById('restaurant-phone-contact');
            if (phoneContact) {
              phoneContact.textContent = phone;
              phoneContact.href = `tel:${normalizedPhone}`;
            }
            const phoneFooter = document.getElementById('restaurant-phone-footer');
            if (phoneFooter) {
              phoneFooter.textContent = phone;
              phoneFooter.href = `tel:${normalizedPhone}`;
            }
            const callBtn = document.getElementById('contact-call-btn');
            if (callBtn) callBtn.href = `tel:${normalizedPhone}`;
          }
          
          // –õ–æ–≥–æ—Ç–∏–ø–∏ –∑ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å
          if (settings.site_logo) {
            const siteLogo = document.getElementById('site-logo');
            if (siteLogo) siteLogo.src = addCacheBuster(settings.site_logo);
          }
          if (settings.app_icon) {
            const appIcon = document.getElementById('app-icon');
            if (appIcon) appIcon.src = addCacheBuster(settings.app_icon);
          }

          // Listen for service worker messages to refresh logos instantly when other admin uploads
          try {
            if (navigator.serviceWorker && navigator.serviceWorker.addEventListener) {
              navigator.serviceWorker.addEventListener('message', (ev) => {
                const msg = ev.data || {};
                if (msg.type === 'purged' && msg.path) {
                  if (msg.path.startsWith('/att/') || msg.path.includes('/att/')) {
                    const siteLogo = document.getElementById('site-logo'); if (siteLogo) siteLogo.src = addCacheBuster(msg.path);
                  }
                  if (msg.path.startsWith('/icons/') || msg.path.includes('/icons/')) {
                    const appIcon = document.getElementById('app-icon'); if (appIcon) appIcon.src = addCacheBuster(msg.path);
                  }
                }
              });
            }
          } catch (e) {}

          const addrEl = document.getElementById('restaurant-address-contact');
          if (addrEl) {
            addrEl.textContent = settings.restaurant_address || addrEl.textContent;
          }
          
          // –û–Ω–æ–≤–ª—é—î–º–æ –≥–æ–¥–∏–Ω–∏ —Ä–æ–±–æ—Ç–∏
          if (settings.working_hours) {
            const hoursFooter = document.getElementById('restaurant-hours-footer');
            if (hoursFooter) hoursFooter.textContent = settings.working_hours;
            const hoursContact = document.getElementById('restaurant-hours-contact');
            if (hoursContact) hoursContact.textContent = settings.working_hours;
          }

          const aboutDescription = settings.about_description || DEFAULT_ABOUT_DESCRIPTION;
          const aboutDescEl = document.getElementById('about-description-text');
          if (aboutDescEl) {
            aboutDescEl.textContent = aboutDescription;
          }

          const emailCard = document.getElementById('contact-email-card');
          const emailLink = document.getElementById('restaurant-email-contact');
          if (emailLink && emailCard) {
            if (settings.restaurant_email) {
              emailLink.textContent = settings.restaurant_email;
              emailLink.href = `mailto:${settings.restaurant_email}`;
              emailCard.style.display = '';
            } else {
              emailCard.style.display = 'none';
            }
          }

          if (settings.about_highlights) {
            try {
              const highlights = JSON.parse(settings.about_highlights);
              if (Array.isArray(highlights) && highlights.length) {
                renderAboutHighlights(highlights);
              } else {
                renderAboutHighlights([]);
              }
            } catch (e) {
              console.warn('–ü–æ–º–∏–ª–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥—É about_highlights:', e);
              renderAboutHighlights([]);
            }
          } else {
            renderAboutHighlights([]);
          }

          recommendationsTitle = settings.recommendations_title || '–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó —à–µ—Ñ–∞';
          updateRecommendationsTitle(recommendationsTitle);

          if (settings.recommendations_items) {
            try {
              const parsed = JSON.parse(settings.recommendations_items);
              if (Array.isArray(parsed)) {
                recommendationsFallbackItems = parsed;
              } else {
                recommendationsFallbackItems = [];
              }
            } catch (e) {
              console.warn('–ü–æ–º–∏–ª–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥—É recommendations_items:', e);
              recommendationsFallbackItems = [];
            }
          } else {
            recommendationsFallbackItems = [];
          }

          if (!Array.isArray(popularProducts) || popularProducts.length === 0) {
            renderRecommendationFallback(recommendationsFallbackItems);
          }
          
          const reviewButton = document.getElementById('review-cta-button');
          const reviewHintEl = document.getElementById('review-hint');
          const rawReviewUrl = typeof settings.google_review_url === 'string' ? settings.google_review_url.trim() : '';
          siteSettings.google_review_url = rawReviewUrl;
          const hasReviewUrl = !!rawReviewUrl;
          if (reviewHintEl) {
            reviewHintEl.textContent = hasReviewUrl
              ? '–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É, —â–æ–± –∑–∞–ª–∏—à–∏—Ç–∏ –≤—ñ–¥–≥—É–∫ —É Google.'
              : '–ü–æ—Å–∏–ª–∞–Ω–Ω—è —â–µ –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–µ, –≤–∏ –º–æ–∂–µ—Ç–µ –æ—Ü—ñ–Ω–∏—Ç–∏ –Ω–∞—Å —Ç—É—Ç.';
          }
          if (reviewButton) {
            reviewButton.setAttribute('aria-describedby', 'review-hint');
            reviewButton.dataset.hasLink = hasReviewUrl ? '1' : '0';
          }

          // –û–Ω–æ–≤–ª—é—î–º–æ —Å–æ—Ü—ñ–∞–ª—å–Ω—ñ –º–µ—Ä–µ–∂—ñ
          if (settings.social_links) {
            renderSocialLinks(settings.social_links);
          }
          
          // –û–Ω–æ–≤–ª—é—î–º–æ PayPal Client ID —è–∫—â–æ —î
          if (settings.paypal_client_id) {
            paypalClientId = settings.paypal_client_id;
          }
        }
      } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å:', error);
      }
    }
    
    // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–æ—Ü–º–µ—Ä–µ–∂ —É —Ñ—É—Ç–µ—Ä—ñ
    function renderSocialLinks(socialLinksJson) {
      const footerContainer = document.getElementById('social-links-footer');
      const contactContainer = document.getElementById('contacts-social');
      const placeholder = '<span class="contact-placeholder">–î–æ–¥–∞–π—Ç–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –≤ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ, —ñ –≤–æ–Ω–∏ –∑\'—è–≤–ª—è—Ç—å—Å—è —Ç—É—Ç.</span>';

      let links = [];
      try {
        const parsed = JSON.parse(socialLinksJson);
        if (Array.isArray(parsed)) {
          links = parsed.filter(link => {
            if (!link || typeof link.url !== 'string') return false;
            return /^https?:\/\//i.test(link.url.trim());
          });
        }
      } catch (e) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥—É —Å–æ—Ü–º–µ—Ä–µ–∂:', e);
      }

      const hasLinks = links.length > 0;
      const footerMarkup = hasLinks ? links.map(link => {
        const iconClass = link.icon || getSocialIconClass(link.url);
        const title = link.name || '';
        const safeUrl = link.url.trim();
        return `<a href="${safeUrl}" target="_blank" rel="noopener" title="${escapeHtml(title)}" style="color:var(--tomato);transition:transform .2s,color .2s" onmouseover="this.style.transform='scale(1.2)';this.style.color='#ff6b47'" onmouseout="this.style.transform='scale(1)';this.style.color='var(--tomato)'"><i class="${iconClass}"></i></a>`;
      }).join('') : '';

      if (footerContainer) {
        footerContainer.innerHTML = footerMarkup;
      }

      if (contactContainer) {
        if (!hasLinks) {
          contactContainer.innerHTML = placeholder;
        } else {
          const labelMap = {
            'fab fa-facebook': 'Facebook',
            'fab fa-instagram': 'Instagram',
            'fab fa-twitter': 'Twitter',
            'fab fa-telegram': 'Telegram',
            'fab fa-viber': 'Viber',
            'fab fa-youtube': 'YouTube',
            'fab fa-tiktok': 'TikTok',
            'fab fa-linkedin': 'LinkedIn',
            'fab fa-pinterest': 'Pinterest',
            'fab fa-whatsapp': 'WhatsApp',
            'fab fa-facebook-messenger': 'Messenger'
          };
          contactContainer.innerHTML = links.map(link => {
            const iconClass = link.icon || getSocialIconClass(link.url);
            const baseLabel = labelMap[iconClass] || link.name || '–°–æ—Ü–º–µ—Ä–µ–∂–∞';
            const safeUrl = link.url.trim();
            return `<a href="${safeUrl}" target="_blank" rel="noopener"><i class="${iconClass}"></i>${escapeHtml(baseLabel)}</a>`;
          }).join('');
        }
      }
    }
    
    // –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è —ñ–∫–æ–Ω–∫–∏ –∑–∞ URL
    function getSocialIconClass(url) {
      if (!url) return 'fas fa-link';
      const lowerUrl = url.toLowerCase();
      
      if (lowerUrl.includes('facebook.com') || lowerUrl.includes('fb.com')) return 'fab fa-facebook';
      if (lowerUrl.includes('instagram.com') || lowerUrl.includes('instagr.am')) return 'fab fa-instagram';
      if (lowerUrl.includes('twitter.com') || lowerUrl.includes('x.com')) return 'fab fa-twitter';
      if (lowerUrl.includes('telegram.me') || lowerUrl.includes('t.me')) return 'fab fa-telegram';
      if (lowerUrl.includes('viber')) return 'fab fa-viber';
      if (lowerUrl.includes('youtube.com') || lowerUrl.includes('youtu.be')) return 'fab fa-youtube';
      if (lowerUrl.includes('tiktok.com')) return 'fab fa-tiktok';
      if (lowerUrl.includes('linkedin.com')) return 'fab fa-linkedin';
      if (lowerUrl.includes('pinterest.com')) return 'fab fa-pinterest';
      if (lowerUrl.includes('whatsapp.com') || lowerUrl.includes('wa.me')) return 'fab fa-whatsapp';
      if (lowerUrl.includes('messenger.com') || lowerUrl.includes('m.me')) return 'fab fa-facebook-messenger';
      
      return 'fas fa-link';
    }

    // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –∑ —Å–µ—Ä–≤–µ—Ä–∞ —Ç–∞ —Ä–µ–Ω–¥–µ—Ä–∏–º–æ –∫–Ω–æ–ø–∫–∏
    async function loadCategories() {
      try {
        const response = await fetch(`${API_URL}/products/categories/list`);
        if (response.ok) {
          categoriesData = await response.json();
          renderCategoryButtons();
          applySeoSettings(siteSettings);
        }
      } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ–π:', error);
      }
    }

    // –†–µ–Ω–¥–µ—Ä–∏–º–æ –∫–Ω–æ–ø–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π
    function renderCategoryButtons() {
      const tabsContainer = document.querySelector('.tabs');
      if (!tabsContainer) return;

      tabsContainer.innerHTML = '';

      categoriesData.forEach((category, index) => {
        const btn = document.createElement('div');
        btn.className = 'tab' + (index === 0 ? ' active' : '');
        btn.setAttribute('data-cat', category.slug);
        btn.innerHTML = `${category.icon || ''} ${category.name}`.trim();

        // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –∫–ª—ñ–∫—É
        btn.addEventListener('click', async () => {
          const newCat = btn.dataset.cat;

          // –Ø–∫—â–æ —Ü–µ –≤–∂–µ –∞–∫—Ç–∏–≤–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è —ñ —î –¥–∞–Ω—ñ, –Ω—ñ—á–æ–≥–æ –Ω–µ —Ä–æ–±–∏–º–æ
          if (currentCat === newCat && menuData[newCat] && Array.isArray(menuData[newCat]) && menuData[newCat].length > 0) {
            return;
          }

          document.querySelector('.tab.active')?.classList.remove('active');
          btn.classList.add('active');

          // –ü–æ–∫–∞–∑—É—î–º–æ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ –ø–ª–∞–≤–Ω–æ—é –∞–Ω—ñ–º–∞—Ü—ñ—î—é
          const menuGrid = document.getElementById('menuGrid');
          menuGrid.style.opacity = '0.3';
          menuGrid.style.transition = 'opacity 0.2s';

          // –ê–Ω—ñ–º–∞—Ü—ñ—è –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è
          btn.style.transform = 'scale(0.95)';
          setTimeout(() => {
            btn.style.transform = '';
          }, 200);

          // –ó–∞–≤–∂–¥–∏ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –¥–∞–Ω—ñ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç—ñ—ó –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—ñ
          try {
            const response = await fetch(`${API_URL}/products/menu`);
            if (response.ok) {
              const freshMenuData = await response.json();
              // –û–Ω–æ–≤–ª—é—î–º–æ menuData –ø–æ–≤–Ω—ñ—Å—Ç—é
              menuData = freshMenuData;

              // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø–æ—Ç–æ—á–Ω—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—é –ø—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö
              currentCat = newCat;

              // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —î –¥–∞–Ω—ñ –¥–ª—è —Ü—ñ—î—ó –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
              if (!menuData[currentCat] || !Array.isArray(menuData[currentCat]) || menuData[currentCat].length === 0) {
                menuGrid.innerHTML = '<p style="text-align:center;grid-column:1/-1;padding:2rem;opacity:0;animation:fadeIn 0.3s forwards">–ù–µ–º–∞—î —Ç–æ–≤–∞—Ä—ñ–≤ —É —Ü—ñ–π –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</p>';
                menuGrid.style.opacity = '1';
                return;
              }

              // –ù–µ–≤–µ–ª–∏–∫–∞ –∑–∞—Ç—Ä–∏–º–∫–∞ –¥–ª—è –ø–ª–∞–≤–Ω–æ—ó –∞–Ω—ñ–º–∞—Ü—ñ—ó
              setTimeout(() => {
                render();
              }, 100);
            } else {
              throw new Error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–µ–Ω—é');
            }
          } catch (error) {
            console.error('–ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –º–µ–Ω—é:', error);
            menuGrid.innerHTML = '<p style="text-align:center;grid-column:1/-1;padding:2rem;color:var(--tomato)">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–µ–Ω—é. –°–ø—Ä–æ–±—É–π—Ç–µ –æ–Ω–æ–≤–∏—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É.</p>';
            menuGrid.style.opacity = '1';
          }
        });

        tabsContainer.appendChild(btn);
      });
    }

    // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –º–µ–Ω—é –∑ —Å–µ—Ä–≤–µ—Ä–∞
    async function loadMenu(forceReload = false) {
      if (menuLoadingPromise && !forceReload) {
        return menuLoadingPromise;
      }

      menuLoadingPromise = (async () => {
        try {
          const menuGrid = document.getElementById('menuGrid');
          if (menuGrid) {
            menuGrid.innerHTML = '<div class="loader"><i class="fas fa-spinner"></i><p>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–µ–Ω—é...</p></div>';
          }

          await loadCategories();

          const response = await fetch(`${API_URL}/products/menu`);
          if (!response.ok) {
            throw new Error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–µ–Ω—é');
          }

          const payload = await response.json();
          menuData = payload && typeof payload === 'object' ? payload : {};

          const categories = Object.keys(menuData);
          if (!currentCat || !menuData[currentCat]) {
            currentCat = categories[0] || '';
          }

          render();
        } catch (error) {
          console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–µ–Ω—é:', error);
          const grid = document.getElementById('menuGrid');
          if (grid) {
            grid.innerHTML = '<p style="text-align:center;padding:2rem;color:var(--tomato)">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–µ–Ω—é. –°–ø—Ä–æ–±—É–π—Ç–µ –æ–Ω–æ–≤–∏—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É.</p>';
          }
        } finally {
          menuLoadingPromise = null;
        }
      })();

      return menuLoadingPromise;
    }

    async function loadPopularProducts(limit = 12) {
      try {
        if (menuLoadingPromise) {
          try {
            await menuLoadingPromise;
          } catch (unexpected) {}
        }
        const response = await fetch(`${API_URL}/products/popular?limit=${encodeURIComponent(limit)}`);
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        const data = await response.json();
        if (Array.isArray(data) && data.length > 0) {
          renderRecommendationCarousel(data);
        } else {
          renderRecommendationFallback(recommendationsFallbackItems);
        }
      } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–æ–ø—É–ª—è—Ä–Ω–∏—Ö —Ç–æ–≤–∞—Ä—ñ–≤:', error);
        renderRecommendationFallback(recommendationsFallbackItems);
      }
    }

    // –î–æ–¥–∞—î–º–æ product_id –¥–æ cart –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ —Ç–æ–≤–∞—Ä—É
    function getProductIdByName(name) {
      for (const cat of Object.values(menuData)) {
        const prod = cat.find(p => p.name === name);
        if (prod) return prod.id;
      }
      return null;
    }

    // –û–Ω–æ–≤–ª—é—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—é getQty –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –≤–∞—Ä—ñ–∞—Ü—ñ—è–º–∏
    function getQty(name) {
      // –î–ª—è —Å–∫–ª–∞–¥–Ω–∏—Ö —Ç–æ–≤–∞—Ä—ñ–≤ –∑ –≤–∞—Ä—ñ–∞—Ü—ñ—è–º–∏ - —Ä–∞—Ö—É—î–º–æ –í–°–Ü –≤–∞—Ä—ñ–∞—Ü—ñ—ó
      const product = Object.values(menuData).flat().find(p => p.name === name);
      
      if (product && product.product_type === 'complex') {
        let total = 0;
        cart.forEach(item => {
          if (item.baseName === name) {
            total += item.qty;
          }
        });
        return total;
      }
      
      // –î–ª—è –ø—Ä–æ—Å—Ç–∏—Ö —Ç–æ–≤–∞—Ä—ñ–≤ - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –ª–æ–≥—ñ–∫–∞
      const item = cart.find(i => i.name === name);
      return item ? item.qty : 0;
    }

    function createFlyingItem(startX, startY, isNewItem) {
      const cartBtn = document.querySelector('.cart-btn');
      const cartRect = cartBtn.getBoundingClientRect();
      const endX = cartRect.left + cartRect.width / 2;
      const endY = cartRect.top + cartRect.height / 2;
      
      const flyingItem = document.createElement('div');
      flyingItem.className = 'flying-item';
      flyingItem.innerHTML = isNewItem ? 'üçï' : '+';
      flyingItem.style.left = startX + 'px';
      flyingItem.style.top = startY + 'px';
      flyingItem.style.setProperty('--tx', (endX - startX) + 'px');
      flyingItem.style.setProperty('--ty', (endY - startY) + 'px');
      
      document.body.appendChild(flyingItem);
      
      setTimeout(() => {
        if (flyingItem.parentNode) {
          document.body.removeChild(flyingItem);
        }
      }, 800);
    }

    function updateCardQuantity(name, qty) {
      document.querySelectorAll('.card').forEach(card => {
        const title = card.querySelector('.card-title');
        if (title && title.textContent === name) {
          const qtyVal = card.querySelector('.qty-val');
          if (qtyVal) {
            qtyVal.textContent = qty;
            qtyVal.style.transform = 'scale(1.3)';
            setTimeout(() => {
              qtyVal.style.transform = '';
            }, 200);
          }
        }
      });
    }

    // –û–Ω–æ–≤–ª—é—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—é render –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –¥–∞–Ω–∏–º–∏ –∑ —Å–µ—Ä–≤–µ—Ä–∞
    function render() {
      const g = document.getElementById('menuGrid');
      if (!g) return;
      
      // –û—á–∏—â–∞—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –∫–æ–Ω—Ç–µ–Ω—Ç
      g.innerHTML = '';
      
      // –û—Ç—Ä–∏–º—É—î–º–æ —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä—ñ–≤ –¥–ª—è –ø–æ—Ç–æ—á–Ω–æ—ó –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
      let list = menuData[currentCat] || [];
      
      // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —Ü–µ –º–∞—Å–∏–≤
      if (!Array.isArray(list)) {
        list = [];
      }
      
      if(searchStr) {
        list = list.filter(it => it.name && it.name.toLowerCase().includes(searchStr.toLowerCase()));
      }
      
      if(list.length === 0) {
        g.innerHTML = '<p style="text-align:center;grid-column:1/-1;padding:2rem;opacity:0;animation:fadeIn 0.3s forwards">–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</p>';
        g.style.opacity = '1';
        return;
      }
      
      // –ü–ª–∞–≤–Ω–∞ –∞–Ω—ñ–º–∞—Ü—ñ—è –ø–æ—è–≤–∏
      g.style.opacity = '0';
      g.style.transition = 'opacity 0.3s';
      
      // –†–µ–Ω–¥–µ—Ä–∏–º–æ —Ç–æ–≤–∞—Ä–∏
      list.forEach((it, i) => {
        if (!it || !it.name) return; // –ü—Ä–æ–ø—É—Å–∫–∞—î–º–æ –Ω–µ–≤–∞–ª—ñ–¥–Ω—ñ —Ç–æ–≤–∞—Ä–∏
        
        const qty = getQty(it.name);
        const c = document.createElement('article'); 
        c.className = 'card'; 
        if (it.id !== undefined && it.id !== null) {
          c.setAttribute('data-product-id', it.id);
        }
        if (it.name) {
          c.setAttribute('data-product-name', it.name);
        }
        if (it.slug) {
          c.setAttribute('data-product-slug', it.slug);
        }
        
        const isComplex = it.product_type === 'complex';
        
        let ingredientsHTML = '';
        // –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ —Å–∫–ª–∞–¥: —Å–ø–æ—á–∞—Ç–∫—É ingredients, –ø–æ—Ç—ñ–º ingredients_text, —ñ–Ω–∞–∫—à–µ description
        const ingr = it.ingredients || it.ingredients_text;
        if (ingr && ingr.trim()) {
          ingredientsHTML = `
            <button class="toggle-ingredients" onclick="toggleIngredients('${it.name}')">
              <i class="fa-solid fa-chevron-down"></i> –°–∫–ª–∞–¥
            </button>
            <div class="ingredients">${escapeHtml(ingr)}</div>
          `;
        }
        // –Ø–∫—â–æ –Ω–µ–º–∞—î —Å–∫–ª–∞–¥—É, fallback –Ω–∞ description (—Ç—ñ–ª—å–∫–∏ —è–∫—â–æ description –Ω–µ —Å–ø—ñ–≤–ø–∞–¥–∞—î –∑ autoDescription)
        // (–ª–æ–≥—ñ–∫–∞ –¥–ª—è SEO/UX, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)
        
        const sizeBadge = it.size ? `<span class="size-badge">${it.size}</span>` : '';
        const priceDisplay = isComplex 
          ? `–≤—ñ–¥ ${Math.min(...it.variants.map(v => v.price))} –≥—Ä–Ω`
          : `${it.base_price} –≥—Ä–Ω`;
        const soldChip = typeof it.sold_count === 'number' && it.sold_count > 0
          ? `<span class="sold-chip"><i class="fas fa-fire"></i> ${it.sold_count}</span>`
          : '';
        
        // –ö–∞—Ä—Ç–∫–∞ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è: –∞–¥–∞–ø—Ç–∏–≤–Ω–æ, webp, width/height, srcset –∑ fallback
        let imageUrl = it.image_url || it.img || '';
        let imageHTML = '';
        const productCategoryName = resolveProductCategory(it);
        const productContext = buildSeoContext({
          product: it.name || '–°—Ç—Ä–∞–≤–∞',
          category: productCategoryName,
          description: it.description || '',
          price: priceDisplay,
          sold: typeof it.sold_count === 'number' ? it.sold_count : '',
          index: i + 1
        });
        const productAltTemplate = siteSettings.seo_product_alt_template || '{{product}}';
        const productDescTemplate = siteSettings.seo_product_description_template || '';
        const productFallbackTemplate = siteSettings.seo_product_fallback_description || '';
        const autoAlt = sanitizeSeoText(renderTemplate(productAltTemplate, productContext)) || it.name || '–°—Ç—Ä–∞–≤–∞';
        // –Ø–∫—â–æ –æ–ø–∏—Å –ø–æ—Ä–æ–∂–Ω—ñ–π ‚Äî –Ω–µ –ø—ñ–¥—Å—Ç–∞–≤–ª—è—Ç–∏ –∞–≤—Ç–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è
        const hasOriginalDescription = it.description && it.description.trim();
        const descriptionHtml = hasOriginalDescription ? it.description : '';
        const safeAlt = escapeHtml(autoAlt);
        
        // –ù–æ—Ä–º–∞–ª—ñ–∑—É—î–º–æ URL –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
        if (imageUrl) {
          // –Ø–∫—â–æ —Ü–µ –≤—ñ–¥–Ω–æ—Å–Ω–∏–π —à–ª—è—Ö (–ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ /uploads –∞–±–æ –ø—Ä–æ—Å—Ç–æ —ñ–º'—è —Ñ–∞–π–ª—É)
          if (imageUrl.startsWith('/uploads') || (!imageUrl.startsWith('http') && !imageUrl.startsWith('//'))) {
            // –î–æ–¥–∞—î–º–æ –±–∞–∑–æ–≤–∏–π URL —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ
            if (imageUrl.startsWith('/')) {
              imageUrl = `${API_URL.replace('/api', '')}${imageUrl}`;
            } else if (!imageUrl.startsWith('http')) {
              // –Ø–∫—â–æ —Ü–µ –ø—Ä–æ—Å—Ç–æ —ñ–º'—è —Ñ–∞–π–ª—É, –¥–æ–¥–∞—î–º–æ /uploads/
              imageUrl = `${API_URL.replace('/api', '')}/uploads/${imageUrl}`;
            }
          }
        }
        
        if (imageUrl) {
          try {
            // –°–ø—Ä–æ–±—É—î–º–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ webp –≤–µ—Ä—Å—ñ—é —è–∫—â–æ –º–æ–∂–ª–∏–≤–æ
            const webpUrl = imageUrl.replace(/\.(jpg|jpeg|png)$/i, '.webp');
            const hasWebp = webpUrl !== imageUrl;
            
            // –ï–∫—Ä–∞–Ω—É—î–º–æ –ª–∞–ø–∫–∏ –¥–ª—è HTML
            const safeImageUrl = imageUrl.replace(/'/g, "&#39;").replace(/"/g, "&quot;");
            const safeWebpUrl = webpUrl.replace(/'/g, "&#39;").replace(/"/g, "&quot;");
            
            imageHTML = hasWebp 
              ? `<picture>
                  <source srcset="${safeWebpUrl}" type="image/webp">
                  <img src="${safeImageUrl}"
                       alt="${safeAlt}"
                       loading="lazy"
                       width="400" height="300"
                       onerror="this.onerror=null; this.parentElement.innerHTML='<div style=\\'aspect-ratio:4/3;background:#f8f8f8;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:48px\\'>üçï</div>';"
                       style="aspect-ratio:4/3;object-fit:cover;width:100%;border-radius:12px;background:#f8f8f8;"
                  >
                </picture>`
              : `<img src="${safeImageUrl}"
                     alt="${safeAlt}"
                     loading="lazy"
                     width="400" height="300"
                     onerror="this.onerror=null; this.outerHTML='<div style=\\'aspect-ratio:4/3;background:#f8f8f8;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:48px\\'>üçï</div>';"
                     style="aspect-ratio:4/3;object-fit:cover;width:100%;border-radius:12px;background:#f8f8f8;"
                 >`;
          } catch (e) {
            console.error('–ü–æ–º–∏–ª–∫–∞ –æ–±—Ä–æ–±–∫–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è:', e, 'URL:', imageUrl);
            // –Ø–∫—â–æ —â–æ—Å—å –ø—ñ—à–ª–æ –Ω–µ —Ç–∞–∫, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –ø—Ä–æ—Å—Ç–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
            imageHTML = `<div style="aspect-ratio:4/3;background:#f8f8f8;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:48px">üçï</div>`;
          }
        } else {
          // Fallback —è–∫—â–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤—ñ–¥—Å—É—Ç–Ω—î
          imageHTML = `<div style="aspect-ratio:4/3;background:#f8f8f8;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:48px">üçï</div>`;
        }
        const likeHtml = createLikeButtonMarkup(it.id);
        
        c.innerHTML = imageHTML +
          '<div class="card-body">' +
            '<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:0.5rem">' +
              '<h3 class="card-title">' + it.name + '</h3>' +
              sizeBadge +
            '</div>' +
            (it.is_new ? '<span style="background:#ff6b6b;color:#fff;padding:2px 8px;border-radius:12px;font-size:.8rem;animation:pulse 2s infinite">–ù–æ–≤–∏–Ω–∫–∞</span>' : '') +
            '<p class="card-price">' + 
              priceDisplay + 
              (it.is_promo ? '<span class="promo-badge">–ê–∫—Ü—ñ—è</span>' : '') + 
              (it.is_vegan ? '<span style="color:#6a994e;margin-left:8px">üå± –≤–µ–≥–∞–Ω</span>' : '') + 
            '</p>' +
            (descriptionHtml ? '<p style="font-size:0.9rem;color:#666;margin:0.5rem 0">' + descriptionHtml + '</p>' : '') +
            ingredientsHTML +
            '<div class="card-engagement">' +
              likeHtml +
              (soldChip || '') +
            '</div>' +
            '<div class="qty-row">' +
              '<button class="qty-btn" onclick="' + 
                (isComplex ? `openComplexProductModal('${it.name}')` : `changeQty('${it.name}',${it.base_price},-1, event, true)`) + 
              '">-</button>' +
              '<span class="qty-val">' + qty + '</span>' +
              '<button class="qty-btn" onclick="' + 
                (isComplex ? `openComplexProductModal('${it.name}')` : `changeQty('${it.name}',${it.base_price},1, event, true)`) + 
              '">+</button>' +
            '</div>' +
          '</div>';
        g.appendChild(c);
        
        setTimeout(() => {
          c.classList.add('visible');
        }, i * 50);
      });
      
      // –ü–ª–∞–≤–Ω–µ –∑'—è–≤–ª–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–Ω—Ç—É –ø—ñ—Å–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥—É –≤—Å—ñ—Ö –∫–∞—Ä—Ç–æ–∫
      setTimeout(() => {
        g.style.opacity = '1';
      }, 100);

      refreshAllLikeButtons();

      if (pendingMenuHighlight) {
        const highlightTarget = pendingMenuHighlight;
        pendingMenuHighlight = null;
        setTimeout(() => {
          focusMenuCard(highlightTarget.id, highlightTarget.name);
        }, 80);
      }
    }

    function changeQty(name, price, delta, event, showAnimation = true) {
      const item = cart.find(i => i.name === name);
      const isNewItem = !item && delta > 0;
      const productId = getProductIdByName(name);
      if(!productId) {
        alert('–ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä —É –º–µ–Ω—é!');
        return;
      }
      if(!item) {
        if(delta > 0) {
          cart.push({name, price, qty: delta, product_id: productId});
          
          if (showAnimation && event) {
            const rect = event.target.getBoundingClientRect();
            const startX = rect.left + rect.width / 2;
            const startY = rect.top + rect.height / 2;
            createFlyingItem(startX, startY, true);
          }
        }
      } else {
        const oldQty = item.qty;
        item.qty = Math.max(0, item.qty + delta);
        if(item.qty === 0) {
          cart = cart.filter(i => i.name !== name);
        } else if (delta > 0 && showAnimation && event) {
          const rect = event.target.getBoundingClientRect();
          const startX = rect.left + rect.width / 2;
          const startY = rect.top + rect.height / 2;
          createFlyingItem(startX, startY, false);
        }
      }
      
      localStorage.setItem('kisso-cart', JSON.stringify(cart));
      const totalCount = cart.reduce((s, i) => s + i.qty, 0);
      const countBadge = document.getElementById('count');
      countBadge.textContent = totalCount;
      
      countBadge.classList.add('pulse');
      setTimeout(() => countBadge.classList.remove('pulse'), 500);
      
      updateCardQuantity(name, getQty(name));
      
      if(document.getElementById('cartModal').classList.contains('open')) {
        updateCart();
      }
    }

    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Å–∫–ª–∞–¥–Ω–∏—Ö —Ç–æ–≤–∞—Ä—ñ–≤
    function openComplexProductModal(productName) {
      const product = Object.values(menuData).flat().find(p => p.name === productName);
      if (!product || !product.variants) return;
      
      // –°—Ç–≤–æ—Ä—é—î–º–æ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –≤–∏–±–æ—Ä—É –≤–∞—Ä—ñ–∞—Ü—ñ—ó
      const modal = document.createElement('div');
      modal.className = 'juice-modal open';
      modal.innerHTML = `
        <div class="juice-content">
          <button onclick="this.closest('.juice-modal').remove()" style="align-self:flex-end;background:none;border:none;font-size:1.5rem;cursor:pointer;position:absolute;top:1rem;right:1rem;z-index:10" aria-label="–ó–∞–∫—Ä–∏—Ç–∏">‚úñ</button>
          <h2>${product.name}</h2>
          <p>–û–±–µ—Ä—ñ—Ç—å –≤–∞—Ä—ñ–∞—Ü—ñ—é:</p>
          <div class="juice-grid" id="complex-product-grid"></div>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      const grid = modal.querySelector('#complex-product-grid');
      product.variants.forEach((variant, i) => {
        const cartItem = cart.find(item => 
          item.baseName === productName && 
          item.variantName === variant.variant_name
        );
        
        const currentQty = cartItem ? cartItem.qty : 0;
        
        const card = document.createElement('div');
        card.className = 'juice-card';
        card.style.animationDelay = (i * 100) + 'ms';
        card.innerHTML = `
          <h4>${variant.variant_name}</h4>
          ${variant.description ? `<p style="font-size:0.8rem;color:#666;margin:0.5rem 0">${variant.description}</p>` : ''}
          <div class="qty-row" style="justify-content:center;margin-top:0.5rem">
            <button class="qty-btn" onclick="changeComplexProductQty('${productName}', '${variant.variant_name}', ${variant.price}, -1, event)" style="width:25px;height:25px;font-size:0.8rem">-</button>
            <span class="qty-val" style="margin:0 0.5rem;font-weight:bold">${currentQty}</span>
            <button class="qty-btn" onclick="changeComplexProductQty('${productName}', '${variant.variant_name}', ${variant.price}, 1, event)" style="width:25px;height:25px;font-size:0.8rem">+</button>
          </div>
          <p class="price">${variant.price} –≥—Ä–Ω</p>
        `;
        
        grid.appendChild(card);
        
        setTimeout(() => {
          card.classList.add('visible');
        }, 50 + i * 100);
      });
      
      // –ó–∞–∫—Ä–∏—Ç—Ç—è –ø–æ –∫–ª—ñ–∫—É –Ω–∞ –æ–≤–µ—Ä–ª–µ–π
      modal.addEventListener('click', (e) => {
        if (e.target === modal) modal.remove();
      });
    }

    function changeComplexProductQty(baseName, variantName, price, delta, event) {
      const cartItem = cart.find(item => 
        item.baseName === baseName && 
        item.variantName === variantName
      );
      
      const fullName = `${baseName} (${variantName})`;
      
      if (!cartItem) {
        if (delta > 0) {
          const product = Object.values(menuData).flat().find(p => p.name === baseName);
          const product_id = product ? product.id : null;
          let variant_id = null;
          if (product && product.variants) {
            const v = product.variants.find(v => v.variant_name === variantName);
            if (v) variant_id = v.id;
          }
          cart.push({
            name: fullName,
            baseName: baseName,
            variantName: variantName,
            price: price,
            qty: delta,
            product_id: product_id,
            variant_id: variant_id
          });
        }
      } else {
        cartItem.qty = Math.max(0, cartItem.qty + delta);
        if (cartItem.qty === 0) {
          const itemIndex = cart.findIndex(i => i.baseName === baseName && i.variantName === variantName);
          cart.splice(itemIndex, 1);
        }
      }
      
      localStorage.setItem('kisso-cart', JSON.stringify(cart));
      const totalCount = cart.reduce((s, i) => s + i.qty, 0);
      document.getElementById('count').textContent = totalCount;
      
      // –û–Ω–æ–≤–ª—é—î–º–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤ –º–æ–¥–∞–ª—å–Ω–æ–º—É –≤—ñ–∫–Ω—ñ
      const modal = document.querySelector('.juice-modal.open');
      if (modal) {
        const cards = modal.querySelectorAll('.juice-card');
        cards.forEach(card => {
          const title = card.querySelector('h4');
          if (title && title.textContent === variantName) {
            const qtySpan = card.querySelector('.qty-val');
            const newQty = cart.find(item => 
              item.baseName === baseName && 
              item.variantName === variantName
            )?.qty || 0;
            qtySpan.textContent = newQty;
          }
        });
      }
      
      // –û–Ω–æ–≤–ª—é—î–º–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –Ω–∞ –∫–∞—Ä—Ç—Ü—ñ –º–µ–Ω—é
      document.querySelectorAll('.card').forEach(card => {
        const title = card.querySelector('.card-title');
        if (title && title.textContent === baseName) {
          const qtyVal = card.querySelector('.qty-val');
          if (qtyVal) {
            qtyVal.textContent = getQty(baseName);
          }
        }
      });
      
      const countBadge = document.getElementById('count');
      countBadge.classList.add('pulse');
      setTimeout(() => countBadge.classList.remove('pulse'), 500);
      
      if(document.getElementById('cartModal').classList.contains('open')) {
        updateCart();
      }
    }

    function toggleIngredients(name) {
      const btn = event.currentTarget;
      const ingredients = btn.nextElementSibling;
      
      btn.classList.toggle('open');
      ingredients.classList.toggle('open');
      
      const icon = btn.querySelector('i');
      if (btn.classList.contains('open')) {
        icon.className = 'fa-solid fa-chevron-right';
      } else {
        icon.className = 'fa-solid fa-chevron-down';
      }
    }

    function toggleNav() {
      const nav = document.getElementById('main-nav');
      const burger = document.querySelector('.burger');
      nav.classList.toggle('open');
      burger.classList.toggle('open');
      
      if (nav.classList.contains('open')) {
        document.querySelectorAll('#main-nav a').forEach((a, i) => {
          a.style.transitionDelay = (i * 0.1) + 's';
          // –î–æ–¥–∞—î–º–æ –∑–∞–∫—Ä–∏—Ç—Ç—è –º–µ–Ω—é –ø—Ä–∏ –∫–ª—ñ–∫—É –Ω–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
          a.onclick = function() {
            nav.classList.remove('open');
            burger.classList.remove('open');
          };
        });
      }
    }
    
    function toggleCart() {
      const modal = document.getElementById('cartModal');
      modal.classList.toggle('open');
      if(modal.classList.contains('open')) {
        updateCart();
        autoSelectTableFromUrl();
      }
    }
    
    function updateCart() {
      const list = document.getElementById('cartItems');
      const summary = document.getElementById('cartSummary');
      list.innerHTML = '';
      
      if(!cart.length) {
        list.innerHTML = `
          <div class="empty-cart">
            <i class="fas fa-shopping-basket"></i>
            <p>–í–∞—à –∫–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π</p>
            <p style="font-size:0.9rem;margin-top:0.5rem">–î–æ–¥–∞–π—Ç–µ —â–æ—Å—å —Å–º–∞—á–Ω–µ–Ω—å–∫–µ!</p>
          </div>
        `;
        summary.style.display = 'none';
        return;
      }
      
      summary.style.display = 'block';
      
      let total = 0;
      
      cart.forEach((it, index) => {
        const itemTotal = it.price * it.qty;
        total += itemTotal;
        
        const div = document.createElement('div'); 
        div.className = 'cart-item';
        div.style.animationDelay = (index * 50) + 'ms';
        
        // –Ø–∫—â–æ —î variantName, –ø–æ–∫–∞–∑—É—î–º–æ –π–æ–≥–æ
        const variantInfo = it.variantName ? `<div class="cart-item-variant">${it.variantName}</div>` : '';
        
        div.innerHTML = `
          <div class="cart-item-info">
            <div class="cart-item-name">${it.name}</div>
            ${variantInfo}
            <div class="cart-item-price">${it.price} –≥—Ä–Ω/—à—Ç</div>
          </div>
          <div class="cart-item-controls">
            <div class="cart-item-qty">
              <button class="qty-btn" onclick="removeFromCartByName('${it.name}',${it.price},-1)" style="width:25px;height:25px;font-size:0.8rem">-</button>
              <span style="min-width:20px;text-align:center;font-weight:600">${it.qty}</span>
              <button class="qty-btn" onclick="addToCartByName('${it.name}',${it.price},1)" style="width:25px;height:25px;font-size:0.8rem">+</button>
            </div>
            <div class="cart-item-total">${itemTotal} –≥—Ä–Ω</div>
            <button class="cart-item-remove" onclick="removeFromCartByName('${it.name}',${it.price},0)" title="–í–∏–¥–∞–ª–∏—Ç–∏">
              <i class="fas fa-times"></i>
            </button>
          </div>
        `;
        list.appendChild(div);
      });
      
      document.getElementById('cartTotal').textContent = total + ' –≥—Ä–Ω';
      updateCartTotals();
    }
    
    function removeFromCartByName(name, price, delta) {
      const itemIndex = cart.findIndex(i => i.name === name);
      
      if (itemIndex !== -1) {
        if (delta === 0) {
          cart.splice(itemIndex, 1);
        } else {
          cart[itemIndex].qty = Math.max(0, cart[itemIndex].qty + delta);
          if (cart[itemIndex].qty === 0) {
            cart.splice(itemIndex, 1);
          }
        }
      }
      
      localStorage.setItem('kisso-cart', JSON.stringify(cart));
      document.getElementById('count').textContent = cart.reduce((s, i) => s + i.qty, 0);
      updateCart();
      
      // –û–Ω–æ–≤–ª—é—î–º–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –Ω–∞ –∫–∞—Ä—Ç–∫–∞—Ö –º–µ–Ω—é –¥–ª—è —Å–∫–ª–∞–¥–Ω–∏—Ö —Ç–æ–≤–∞—Ä—ñ–≤
      const item = cart.find(i => i.name === name);
      if (item && item.baseName) {
        document.querySelectorAll('.card').forEach(card => {
          const title = card.querySelector('.card-title');
          if (title && title.textContent === item.baseName) {
            const qtyVal = card.querySelector('.qty-val');
            if (qtyVal) {
              qtyVal.textContent = getQty(item.baseName);
            }
          }
        });
      } else {
        updateCardQuantity(name, getQty(name));
      }
    }
    
    function addToCartByName(name, price, delta) {
      const item = cart.find(i => i.name === name);
      
      if (!item) {
        cart.push({name, price, qty: delta});
      } else {
        item.qty += delta;
      }
      
      localStorage.setItem('kisso-cart', JSON.stringify(cart));
      document.getElementById('count').textContent = cart.reduce((s, i) => s + i.qty, 0);
      updateCart();
      
      // –û–Ω–æ–≤–ª—é—î–º–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –Ω–∞ –∫–∞—Ä—Ç–∫–∞—Ö –º–µ–Ω—é –¥–ª—è —Å–∫–ª–∞–¥–Ω–∏—Ö —Ç–æ–≤–∞—Ä—ñ–≤
      const cartItem = cart.find(i => i.name === name);
      if (cartItem && cartItem.baseName) {
        document.querySelectorAll('.card').forEach(card => {
          const title = card.querySelector('.card-title');
          if (title && title.textContent === cartItem.baseName) {
            const qtyVal = card.querySelector('.qty-val');
            if (qtyVal) {
              qtyVal.textContent = getQty(cartItem.baseName);
            }
          }
        });
      } else {
        updateCardQuantity(name, getQty(name));
      }
    }
    
    function toggleFields(sel) {
      const isCafe = sel.value === 'cafe';
      const isTakeaway = sel.value === 'takeaway';
      const addrField = document.getElementById('fieldAddr');
      const tableRow = document.getElementById('tableRow');
      
      if(isCafe) {
        addrField.style.display = 'none';
        addrField.required = false;
        tableRow.style.display = 'block';
        document.getElementById('selectTable').required = true;

        const s = document.getElementById('selectTable');
        if(!s.children.length) {
          for(let i = 1; i <= MAX_TABLES; i++) {
            const o = document.createElement('option');
            o.value = i;
            o.textContent = i;
            s.appendChild(o);
          }
        }
      } else if(isTakeaway) {
        // –ù–∞ –≤–∏–Ω—ñ—Å - –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–∞ –∞–Ω—ñ –∞–¥—Ä–µ—Å–∞, –∞–Ω—ñ —Å—Ç–æ–ª–∏–∫
        addrField.style.display = 'none';
        addrField.required = false;
        tableRow.style.display = 'none';
        document.getElementById('selectTable').required = false;
      } else {
        // –î–æ—Å—Ç–∞–≤–∫–∞
        addrField.style.display = 'block';
        addrField.required = true;
        tableRow.style.display = 'none';
        document.getElementById('selectTable').required = false;
      }
      
      const urlParams = new URLSearchParams(window.location.search);
      const tableFromUrl = urlParams.get('table');
      
      if (tableFromUrl && !isCafe) {
        sel.value = 'cafe';
        toggleFields(sel);
        
        const tableSelect = document.getElementById('selectTable');
        tableSelect.value = tableFromUrl;
        
        const message = document.createElement('div');
        message.style.cssText = 'background: #f9c74f; padding: 10px; border-radius: 8px; margin: 10px 0; text-align: center; font-weight: bold;';
        message.textContent = `–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–±—Ä–∞–Ω–æ —Å—Ç–æ–ª–∏–∫ ‚Ññ${tableFromUrl}`;
        const cartItems = document.getElementById('cartItems');
        if (cartItems.nextSibling) {
          document.querySelector('.cart-content').insertBefore(message, cartItems.nextSibling);
        } else {
          document.querySelector('.cart-content').appendChild(message);
        }
      }
    }

    function autoSelectTableFromUrl() {
      const tableNumber = getUrlParam('table');
      if (tableNumber && parseInt(tableNumber) >= 1 && parseInt(tableNumber) <= MAX_TABLES) {
        const deliverySelect = document.querySelector('select[name="deliveryType"]');
        deliverySelect.value = 'cafe';
        toggleFields(deliverySelect);
        const tableSelect = document.getElementById('selectTable');
        tableSelect.value = tableNumber;
        deliverySelect.disabled = true;
        
        const message = document.createElement('div');
        message.style.cssText = 'background: #f9c74f; padding: 10px; border-radius: 8px; margin: 10px 0; text-align: center; font-weight: bold;';
        message.textContent = `–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–±—Ä–∞–Ω–æ —Å—Ç–æ–ª–∏–∫ ‚Ññ${tableNumber}`;
        const cartItems = document.getElementById('cartItems');
        if (cartItems && cartItems.nextSibling) {
          document.querySelector('.cart-content').insertBefore(message, cartItems.nextSibling);
        } else if (cartItems) {
          cartItems.parentNode.insertBefore(message, cartItems.nextSibling);
        }
      }
    }

    function getUrlParam(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    }

    // –û–Ω–æ–≤–ª—é—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—é –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
    async function handleOrder(e, isPaid = false) {
      if (e) e.preventDefault();
      
      // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É –ø—ñ—Ü–µ—Ä—ñ—ó
      await checkPizzeriaStatus();
      if (!pizzeriaStatus.isOpen) {
        alert('üö´ ' + (pizzeriaStatus.closedMessage || '–ü—ñ—Ü–µ—Ä—ñ—è –∑–∞—Ä–∞–∑ –∑–∞–∫—Ä–∏—Ç–∞. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.'));
        return;
      }
      
      if(!cart.length) {
        alert('–ö–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π');
        return;
      }
      
      const form = document.getElementById('orderForm');
      const formData = new FormData(form);
      // –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω—É
      let rawPhone = formData.get('phone') || '';
      let normalizedPhone = rawPhone.replace(/[^0-9+]/g, '');
      // –Ø–∫—â–æ –Ω–æ–º–µ—Ä –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ '+38', –∑–∞–º—ñ–Ω—é—î–º–æ –Ω–∞ '0'
      if (normalizedPhone.startsWith('+38')) {
        normalizedPhone = '0' + normalizedPhone.slice(3);
      }
      const orderData = {
        customer_name: formData.get('name'),
        customer_phone: normalizedPhone,
        delivery_type: formData.get('deliveryType'),
        delivery_address: formData.get('address'),
        items: cart.map(item => {
          if (!item.product_id) {
            throw new Error('–ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ product_id –¥–ª—è —Ç–æ–≤–∞—Ä—É: ' + item.name);
          }
          return {
            product_id: item.product_id,
            product_name: item.name,
            variant_name: item.variantName,
            variant_id: item.variant_id,
            quantity: item.qty,
            price: item.price
          };
        }),
        total_amount: cart.reduce((s, i) => s + i.price * i.qty, 0) - discountAmount,
        discount_amount: discountAmount,
        promocode: appliedPromocode?.code || null,
        payment_method: formData.get('paymentMethod'),
        is_paid: isPaid ? 1 : 0
      };

      // –î–æ–¥–∞—î–º–æ table_number —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ
      if (formData.get('deliveryType') === 'table' || formData.get('deliveryType') === 'cafe') {
        const tableNum = formData.get('table');
        if (tableNum) {
          orderData.table_number = parseInt(tableNum);
        }
      }

      // –í–∏–¥–∞–ª—è—î–º–æ delivery_address —è–∫—â–æ —Ü–µ –∫–∞—Ñ–µ, —Å—Ç–æ–ª–∏–∫ –∞–±–æ –Ω–∞ –≤–∏–Ω—ñ—Å
      if (formData.get('deliveryType') === 'cafe' || formData.get('deliveryType') === 'table' || formData.get('deliveryType') === 'takeaway') {
        orderData.delivery_address = null;
      }

      const urlParams = new URLSearchParams(window.location.search);
      const tableFromUrl = urlParams.get('table');
      if (tableFromUrl && !orderData.table_number) {
        orderData.delivery_type = 'cafe';
        orderData.table_number = parseInt(tableFromUrl);
      }
      
      const submitBtn = document.getElementById('submitOrderBtn');
      const originalText = submitBtn.textContent;
      submitBtn.textContent = '–í—ñ–¥–ø—Ä–∞–≤–∫–∞...';
      submitBtn.disabled = true;
      
      try {
        const response = await fetch(`${API_URL}/orders`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(orderData)
        });
        
        if (response.ok) {
          const result = await response.json();
          
          // –Ø–∫—â–æ –æ–±—Ä–∞–Ω–æ LiqPay - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î–º–æ –Ω–∞ –æ–ø–ª–∞—Ç—É
          if (orderData.payment_method === 'liqpay' && !isPaid) {
            submitBtn.textContent = '–ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ –æ–ø–ª–∞—Ç–∏...';
            await processLiqPayPayment(result.order_number || result.id, orderData.total_amount);
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;
            return;
          }

          if (orderData.payment_method === 'fop' && !isPaid) {
            submitBtn.textContent = '–ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó...';
            await processFopPayment(result.order_number || result.id, orderData.total_amount);
            submitBtn.textContent = '–†–µ–∫–≤—ñ–∑–∏—Ç–∏ —Å—Ñ–æ—Ä–º–æ–≤–∞–Ω–æ';
            submitBtn.disabled = true;
            return;
          }
          
          submitBtn.textContent = '‚úÖ –£—Å–ø—ñ—à–Ω–æ!';
          submitBtn.style.background = 'var(--olive)';
          
          // –ó–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ –ø—Ä–æ–º–æ–∫–æ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ
          if (appliedPromocode?.code) {
            fetch(`${API_URL}/promocodes/apply`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ code: appliedPromocode.code })
            });
          }

          setTimeout(() => {
            alert('–í–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏–π–Ω—è—Ç–æ!\n–ù–æ–º–µ—Ä –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è: ' + (result.order_number || '‚Äî') + '\nüìû ' + orderData.customer_phone);
            
            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è
            if (result.order_number) {
              trackedOrder = {
                order_number: result.order_number,
                status: 'pending',
                last_checked: Date.now()
              };
              localStorage.setItem('kisso-tracked-order', JSON.stringify(trackedOrder));
              startOrderTracking();
            }
            
            cart = [];
            localStorage.removeItem('kisso-cart');
            document.getElementById('count').textContent = 0;
            document.getElementById('orderForm').reset();
            resetPromocode();
            updateCart();
            toggleCart();

            submitBtn.textContent = originalText;
            submitBtn.style.background = '';
            submitBtn.disabled = false;
          }, 1000);
        } else {
          const error = await response.json();
          alert('‚ùå ' + (error.error || '–ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è') + (error.details ? '\n–î–µ—Ç–∞–ª—ñ: ' + JSON.stringify(error.details) : '') + (error.body ? '\n–¢—ñ–ª–æ: ' + JSON.stringify(error.body) : ''));
          submitBtn.textContent = originalText;
          submitBtn.disabled = false;
        }
      } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞:', error);
        alert('‚ùå –°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è: ' + (error.message || error));
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
      }
    }

    function openReviewLink(event) {
      if (event && typeof event.preventDefault === 'function') {
        event.preventDefault();
      }
      const rawUrl = (siteSettings.google_review_url || '').trim();
      if (rawUrl && /^https?:\/\//i.test(rawUrl)) {
        window.open(rawUrl, '_blank', 'noopener');
        return;
      }
      const hintEl = document.getElementById('review-hint');
      if (hintEl) {
        hintEl.textContent = '–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ Google –Ω–∞—Ä–∞–∑—ñ –≤—ñ–¥—Å—É—Ç–Ω—î. –í–∏ –º–æ–∂–µ—Ç–µ –ø–æ—Å—Ç–∞–≤–∏—Ç–∏ –æ—Ü—ñ–Ω–∫—É —Ç—É—Ç.';
      }
      openRate();
    }

    function openRate() {
      const rating = document.getElementById('starRating');
      if (!rating) {
        return;
      }
      rating.style.display = 'flex';
      
      setTimeout(() => {
        rating.style.opacity = '1';
        rating.style.transform = 'translateY(0)';
      }, 10);
    }

    let lastScroll = 0;
    function handleScroll() {
      const header = document.getElementById('mainHeader');
      const currentScroll = window.scrollY;
      
      if (currentScroll > 50) {
        header.classList.add('scrolled');
      } else {
        header.classList.remove('scrolled');
      }
      
      if (currentScroll > lastScroll && currentScroll > 100) {
        header.classList.add('hidden');
      } else {
        header.classList.remove('hidden');
      }
      
      lastScroll = currentScroll;
      
      document.querySelectorAll('.card').forEach(card => {
        const rect = card.getBoundingClientRect();
        if (rect.top < window.innerHeight * 0.8) {
          card.classList.add('visible');
        }
      });
    }

    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
    document.addEventListener('DOMContentLoaded', async function() {
      // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å API –ø–µ—Ä–µ–¥ —Ç–∏–º —è–∫ –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ
      const menuGrid = document.getElementById('menuGrid');
      const apiOk = await detectApiUrl();
      if (!apiOk) {
        showApiError(menuGrid, '–°–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –±–µ–∫–µ–Ω–¥ —Ç–∞ –Ω–∞—Ç–∏—Å–Ω—É—Ç–∏ –ü–æ–≤—Ç–æ—Ä–∏—Ç–∏.');
      } else {
        // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –º–µ–Ω—é
        await loadSettings();
        loadMenu();
        loadGallerySection();
        loadPopularProducts();
        loadLikes();
        resumeOrderTrackingIfNeeded();
      }

      // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É –ø—ñ—Ü–µ—Ä—ñ—ó
      checkPizzeriaStatus();
      // –ü–µ—Ä—ñ–æ–¥–∏—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É (–∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥)
      setInterval(checkPizzeriaStatus, 30000);
      
      // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–ª–∞–≤–∞—é—á–∏—Ö —ñ–∫–æ–Ω–æ–∫
      const icons = ['fa-pizza-slice', 'fa-burger', 'fa-glass-cheers', 'fa-cookie-bite', 'fa-coffee', 'fa-ice-cream', 'fa-cheese', 'fa-bread-slice'];
      const fi = document.getElementById('floatIcons');
      
      for(let i = 0; i < 30; i++) {
        const el = document.createElement('i');
        el.className = 'fa-solid ' + icons[i % icons.length];
        el.style.left = Math.random() * 100 + '%';
        el.style.animationDelay = (Math.random() * 20) + 's';
        el.style.animationDuration = (18 + Math.random() * 12) + 's';
        el.style.fontSize = (1 + Math.random() * 1.5) + 'rem';
        fi.appendChild(el);
      }
      
      
      // –ü–æ—à—É–∫
      const searchInput = document.getElementById('searchInput');
      searchInput.addEventListener('input', e => {
        searchStr = e.target.value.toLowerCase();
        render();
        
        if (searchStr) {
          searchInput.style.boxShadow = '0 0 0 3px rgba(229, 75, 34, 0.2)';
        } else {
          searchInput.style.boxShadow = '';
        }
      });

      // –ó–∞–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–∏—Ö –≤—ñ–∫–æ–Ω –ø–æ –∫–ª—ñ–∫—É –Ω–∞ –æ–≤–µ—Ä–ª–µ–π
      document.querySelectorAll('.cart-modal, .juice-modal').forEach(modal => {
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            if (modal.id === 'cartModal') toggleCart();
            // –î–ª—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ —Å—Ç–≤–æ—Ä–µ–Ω–∏—Ö juice-modal
            if (e.target.classList.contains('juice-modal')) {
              e.target.remove();
            }
          }
        });
      });
      
      // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ—Ä–∑–∏–Ω–∏ –∑ localStorage
      const saved = JSON.parse(localStorage.getItem('kisso-cart') || '[]');
      cart = saved;
      document.getElementById('count').textContent = cart.reduce((s, i) => s + i.qty, 0);
      
      // –†–µ–π—Ç–∏–Ω–≥
      document.querySelectorAll('#starRating i').forEach(star => {
        star.addEventListener('click', () => {
          const s = +star.dataset.s;
          document.querySelectorAll('#starRating i').forEach((x, i) => {
            x.className = i < s ? 'fa-solid fa-star active' : 'fa-regular fa-star';
            if (i < s) {
              x.style.transform = 'scale(1.3)';
              setTimeout(() => {
                x.style.transform = '';
              }, 300);
            }
          });
          
          setTimeout(() => {
            const alertDiv = document.createElement('div');
            alertDiv.style.cssText = `
              position: fixed;
              top: 20px;
              right: 20px;
              background: var(--olive);
              color: white;
              padding: 15px 20px;
              border-radius: var(--radius);
              z-index: 10000;
              animation: fadeUp 0.5s, fadeOut 0.5s 2.5s forwards;
              box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            `;
            alertDiv.textContent = '–î—è–∫—É—î–º–æ –∑–∞ –≤–∞—à—É –æ—Ü—ñ–Ω–∫—É!';
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
              document.body.removeChild(alertDiv);
            }, 3000);
          }, 150);
        });
      });
      
      // –°–∫—Ä–æ–ª–ª
      window.addEventListener('scroll', handleScroll);

      const prevBtn = document.getElementById('recommendations-prev');
      const nextBtn = document.getElementById('recommendations-next');
      if (prevBtn) prevBtn.addEventListener('click', () => scrollRecommendations(-1));
      if (nextBtn) nextBtn.addEventListener('click', () => scrollRecommendations(1));
      const recoTrack = document.getElementById('recommendations-track');
      if (recoTrack) {
        recoTrack.addEventListener('scroll', updateRecommendationControls, { passive: true });
        updateRecommendationControls();
      }
      
      // Intersection Observer –¥–ª—è –∫–∞—Ä—Ç–æ–∫
      const observerOptions = {
        root: null,
        rootMargin: '0px',
        threshold: 0.1
      };
      
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
          }
        });
      }, observerOptions);
      
      setTimeout(() => {
        document.querySelectorAll('.card').forEach(card => {
          observer.observe(card);
        });
      }, 500);
    });
    
    // ========== PWA Service Worker —Ç–∞ Install Prompt ==========
    let deferredPrompt = null;
    
    // –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', async () => {
        try {
          const registration = await navigator.serviceWorker.register('/sw.js');
          console.log('‚úÖ Service Worker registered:', registration.scope);
        } catch (error) {
          console.log('‚ùå Service Worker registration failed:', error);
        }
      });
    }
    
    // –Ø–∫—â–æ –¥–æ–¥–∞—Ç–æ–∫ –≤–∂–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ (standalone mode) ‚Äî —Ö–æ–≤–∞—î–º–æ –∫–Ω–æ–ø–∫—É
    if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true) {
      const btn = document.getElementById('pwa-install-btn');
      if (btn) btn.style.display = 'none';
    }
    
    // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ prompt –¥–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      console.log('‚úÖ beforeinstallprompt ready');
    });
    
    // –§—É–Ω–∫—Ü—ñ—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è PWA
    async function installPWA() {
      if (deferredPrompt) {
        try {
          deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;
          if (outcome === 'accepted') {
            console.log('‚úÖ PWA installed');
            const btn = document.getElementById('pwa-install-btn');
            if (btn) btn.style.display = 'none';
          }
          deferredPrompt = null;
        } catch (err) {
          console.log('Install prompt error:', err);
          deferredPrompt = null;
        }
        return;
      }
      
      // –Ø–∫—â–æ prompt –Ω–µ –≥–æ—Ç–æ–≤–∏–π ‚Äî —á–µ–∫–∞—î–º–æ 2—Å —ñ –ø—Ä–æ–±—É—î–º–æ –∑–Ω–æ–≤—É
      const btn = document.getElementById('pwa-install-btn');
      if (btn) {
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...';
        btn.disabled = true;
      }
      
      // –ü–µ—Ä–µ—Ä–µ—î—Å—Ç—Ä—É—î–º–æ SW —â–æ–± –æ–Ω–æ–≤–∏—Ç–∏ –º–∞–Ω—ñ—Ñ–µ—Å—Ç
      if ('serviceWorker' in navigator) {
        const reg = await navigator.serviceWorker.getRegistration();
        if (reg) await reg.update();
      }
      
      // –ß–µ–∫–∞—î–º–æ –Ω–∞ beforeinstallprompt
      await new Promise(resolve => {
        const handler = (e) => {
          e.preventDefault();
          deferredPrompt = e;
          window.removeEventListener('beforeinstallprompt', handler);
          resolve();
        };
        window.addEventListener('beforeinstallprompt', handler);
        setTimeout(resolve, 3000);
      });
      
      if (deferredPrompt) {
        try {
          deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;
          if (outcome === 'accepted') {
            console.log('‚úÖ PWA installed');
            if (btn) btn.style.display = 'none';
          }
          deferredPrompt = null;
        } catch (err) {
          console.log('Install prompt error:', err);
          deferredPrompt = null;
        }
      } else {
        // –Ø–∫—â–æ –≤—Å–µ –æ–¥–Ω–æ –Ω–µ —Å–ø—Ä–∞—Ü—é–≤–∞–ª–æ
        if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone) {
          alert('–î–æ–¥–∞—Ç–æ–∫ –≤–∂–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ! –ó–Ω–∞–π–¥—ñ—Ç—å —ñ–∫–æ–Ω–∫—É Kisso –Ω–∞ –≤–∞—à–æ–º—É –µ–∫—Ä–∞–Ω—ñ.');
          if (btn) btn.style.display = 'none';
        }
        // –ù–µ –ø–æ–∫–∞–∑—É—î–º–æ –∂–æ–¥–Ω–∏—Ö —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π ‚Äî –ø—Ä–æ—Å—Ç–æ –Ω—ñ—á–æ–≥–æ –Ω–µ —Ä–æ–±–∏–º–æ
      }
      
      if (btn) {
        btn.innerHTML = '<i class="fas fa-download"></i> –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏';
        btn.disabled = false;
      }
    }
    
    // –ü–æ–¥—ñ—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è
    window.addEventListener('appinstalled', () => {
      console.log('‚úÖ Kisso app installed!');
      deferredPrompt = null;
      const btn = document.getElementById('pwa-install-btn');
      if (btn) btn.style.display = 'none';
    });
    
    // ========== –í–Ü–î–°–¢–ï–ñ–ï–ù–ù–Ø –°–¢–ê–¢–£–°–£ –ó–ê–ú–û–í–õ–ï–ù–ù–Ø ==========
    
    function startOrderTracking() {
      if (!API_URL) {
        shouldResumeOrderTracking = true;
        return;
      }
      if (orderCheckInterval) {
        clearInterval(orderCheckInterval);
      }
      
      if (!trackedOrder || !trackedOrder.order_number) return;
      
      // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∫–æ–∂–Ω—ñ 15 —Å–µ–∫—É–Ω–¥
      orderCheckInterval = setInterval(checkOrderStatus, 15000);
      
      // –û–¥—Ä–∞–∑—É –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ
      checkOrderStatus();
    }
    
    async function checkOrderStatus() {
      if (!trackedOrder || !trackedOrder.order_number) {
        if (orderCheckInterval) {
          clearInterval(orderCheckInterval);
          orderCheckInterval = null;
        }
        return;
      }
      
      try {
        if (!API_URL) return;
        const response = await fetch(`${API_URL}/orders/track/${trackedOrder.order_number}`);
        
        if (response.ok) {
          const data = await response.json();
          
          // –Ø–∫—â–æ —Å—Ç–∞—Ç—É—Å –∑–º—ñ–Ω–∏–≤—Å—è - –ø–æ–∫–∞–∑—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
          if (data.status !== trackedOrder.status) {
            const prevStatus = trackedOrder.status;
            trackedOrder.status = data.status;
            trackedOrder.last_checked = Date.now();
            localStorage.setItem('kisso-tracked-order', JSON.stringify(trackedOrder));
            
            showOrderNotification(data.status, data.order_number, data.wait_time);
            
            // –Ø–∫—â–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ –∞–±–æ —Å–∫–∞—Å–æ–≤–∞–Ω–æ - –∑—É–ø–∏–Ω—è—î–º–æ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è
            if (data.status === 'completed' || data.status === 'cancelled') {
              clearInterval(orderCheckInterval);
              orderCheckInterval = null;
              
              // –ß–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥ –≤–∏–¥–∞–ª—è—î–º–æ –∑ localStorage
              setTimeout(() => {
                trackedOrder = null;
                localStorage.removeItem('kisso-tracked-order');
              }, 30000);
            }
          }
        }
      } catch (error) {
        console.log('–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å—É:', error);
      }
    }
    
    function showOrderNotification(status, orderNumber, waitTime) {
      const messages = {
        'pending': { icon: '‚è≥', title: '–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –æ—á—ñ–∫—É—î', text: '–í–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏–π–Ω—è—Ç–æ —ñ –æ—á—ñ–∫—É—î –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è', color: '#ff9800' },
        'confirmed': { icon: '‚úÖ', title: '–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ!', text: '–í–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ —ñ —Å–∫–æ—Ä–æ –ø–æ—á–Ω–µ –≥–æ—Ç—É–≤–∞—Ç–∏—Å—è', color: '#4caf50' },
        'preparing': { icon: 'üë®‚Äçüç≥', title: '–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –≥–æ—Ç—É—î—Ç—å—Å—è!', text: waitTime ? `–û—Ä—ñ—î–Ω—Ç–æ–≤–Ω–∏–π —á–∞—Å: ${waitTime} —Ö–≤.` : '–í–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –≤–∂–µ –≥–æ—Ç—É—î—Ç—å—Å—è', color: '#2196f3' },
        'completed': { icon: 'üéâ', title: '–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –≥–æ—Ç–æ–≤–µ!', text: '–í–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –≥–æ—Ç–æ–≤–µ. –°–º–∞—á–Ω–æ–≥–æ!', color: '#4caf50' },
        'cancelled': { icon: 'üòî', title: '–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è —Å–∫–∞—Å–æ–≤–∞–Ω–æ', text: '–ù–∞ –∂–∞–ª—å, –≤–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –±—É–ª–æ —Å–∫–∞—Å–æ–≤–∞–Ω–æ. –ó–∞—Ç–µ–ª–µ—Ñ–æ–Ω—É–π—Ç–µ –Ω–∞–º –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–Ω—è.', color: '#f44336' }
      };

      const msg = messages[status] || { icon: '‚ÑπÔ∏è', title: '–°—Ç–∞—Ç—É—Å –æ–Ω–æ–≤–ª–µ–Ω–æ', text: status, color: '#666' };

      // Create overlay and modal using DOM APIs (avoid inline onclick attributes)
      const overlay = document.createElement('div');
      overlay.style.cssText = 'position: fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:100000;display:flex;align-items:center;justify-content:center;padding:1rem;animation:fadeIn .3s ease;';
      overlay.addEventListener('click', () => overlay.remove());

      const modal = document.createElement('div');
      modal.style.cssText = 'background:white;border-radius:20px;padding:2rem;max-width:350px;width:100%;text-align:center;box-shadow:0 10px 40px rgba(0,0,0,0.3);animation:slideUp .3s ease;';
      modal.addEventListener('click', (e) => e.stopPropagation());

      const iconEl = document.createElement('div');
      iconEl.style.fontSize = '4rem';
      iconEl.style.marginBottom = '1rem';
      iconEl.textContent = msg.icon;

      const titleEl = document.createElement('h3');
      titleEl.style.cssText = `color: ${msg.color}; margin: 0 0 .5rem 0; font-size:1.3rem;`;
      titleEl.textContent = msg.title;

      const textEl = document.createElement('p');
      textEl.style.cssText = 'color:#666;margin:0 0 1rem 0;font-size:.95rem;';
      textEl.textContent = msg.text;

      const orderEl = document.createElement('p');
      orderEl.style.cssText = 'color:#999;font-size:.85rem;margin:0 0 1.5rem 0;';
      orderEl.textContent = '–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è: ' + orderNumber;

      const btn = document.createElement('button');
      btn.textContent = '–ó—Ä–æ–∑—É–º—ñ–ª–æ';
      btn.style.cssText = `background:${msg.color};color:#fff;border:none;padding:.8rem 2rem;border-radius:10px;font-size:1rem;font-weight:600;cursor:pointer;`;
      btn.addEventListener('click', () => overlay.remove());

      modal.appendChild(iconEl);
      modal.appendChild(titleEl);
      modal.appendChild(textEl);
      modal.appendChild(orderEl);
      modal.appendChild(btn);
      overlay.appendChild(modal);
      document.body.appendChild(overlay);

      // Vibrate only if user interacted (browser blocks vibration without user gesture)
      try {
        if ((status === 'cancelled' || status === 'completed') && 'vibrate' in navigator && userInteracted) {
          navigator.vibrate(status === 'cancelled' ? [200, 100, 200] : [100, 50, 100]);
        }
      } catch (e) { /* ignore */ }

      // Auto close after 15s
      setTimeout(() => { if (overlay.parentElement) overlay.remove(); }, 15000);
    }
    
    // –ó–∞–ø—É—Å–∫–∞—î–º–æ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —è–∫—â–æ —î –∑–±–µ—Ä–µ–∂–µ–Ω–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
    if (trackedOrder && trackedOrder.order_number) {
      // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –Ω–µ –∑–∞–Ω–∞–¥—Ç–æ —Å—Ç–∞—Ä–µ (–±—ñ–ª—å—à–µ 24 –≥–æ–¥–∏–Ω)
      const hoursSinceOrder = (Date.now() - trackedOrder.last_checked) / (1000 * 60 * 60);
      if (hoursSinceOrder < 24 && trackedOrder.status !== 'completed' && trackedOrder.status !== 'cancelled') {
        shouldResumeOrderTracking = true;
      } else {
        // –í–∏–¥–∞–ª—è—î–º–æ —Å—Ç–∞—Ä–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
        trackedOrder = null;
        localStorage.removeItem('kisso-tracked-order');
      }
    }
  </script>
</body>
</html>
